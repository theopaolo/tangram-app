<script>
	import { goto } from '$app/navigation';
	import { page } from '$app/state';
	import { onMount } from 'svelte';
	import { piecesStore } from '$lib/piecesStore.js';
	import { PIECES_DATA } from '$lib/piecesData';

	
	const PIECES_ENTRIES = Object.entries(PIECES_DATA);

	let foundPieces = $derived($piecesStore);

// --- üéâ EFFET DE PAILLETTES AVEC 2 SVG AL√âATOIRES MONOCOULEUR ---
function triggerConfetti(originEl, color = '#FF0000') {
  if (!originEl) return;

  // Les deux SVG possibles
  const SHAPES = [
    `<svg width="84" height="84" viewBox="0 0 84 84" fill="none" xmlns="http://www.w3.org/2000/svg">
<path d="M74.1696 45.5634C81.09 44.4628 84.9172 51.6691 81.09 57.1982C80.4609 58.1154 72.7279 65.8982 71.9939 66.3437C68.5862 68.3615 67.957 64.1949 66.3842 64.4569C65.7027 64.588 62.3736 68.5711 61.2464 69.4358C25.7795 97.0556 -16.5029 51.1188 10.6543 18.8608C33.5125 -8.31352 76.8696 10.8945 74.1696 45.5634ZM70.3949 46.8212V37.073C70.3949 31.8321 63.9464 21.4812 59.9881 17.9174C36.763 -3.02017 0.0640647 17.996 6.51259 48.7341C12.2009 75.8822 47.0911 83.2195 64.0774 61.6006C53.8804 54.7088 57.5241 41.6851 70.3687 46.8212H70.3949ZM64.5755 48.7865C62.3474 49.2058 61.0891 51.8001 61.692 53.8965C62.1901 55.5998 68.7172 60.6311 70.159 62.4916C70.8405 62.6226 76.8958 56.6217 77.6298 55.626C82.2958 49.4417 74.5366 46.0612 70.6046 51.8001C69.3988 52.0097 67.4328 48.2362 64.5493 48.7865H64.5755Z" fill="black"/>
<path d="M40.2228 51.8266C38.5452 49.573 47.0384 41.7116 51.2063 48.1055C54.0898 52.5341 50.4461 54.7353 50.4723 55.9408C50.4723 56.9889 53.5393 58.7447 51.7044 63.016C48.5587 70.3533 36.4481 61.5748 41.8219 60.0287C43.6568 59.5046 46.7238 65.2172 48.7422 61.2865C50.0005 58.8495 45.8063 57.8013 45.9636 56.0456C46.3044 54.3423 49.6073 52.3245 48.7422 50.595C46.4879 46.0878 42.2675 54.5781 40.2228 51.8266Z" fill="black"/>
<path d="M43.3681 35.475C42.241 28.3473 50.7866 23.3684 56.8681 27.3253C58.4409 28.3473 63.6836 34.453 60.5642 35.4488C57.4186 36.2611 57.8118 32.5663 55.872 30.8367C53.8011 29.0024 50.8914 28.7404 48.6633 30.4699C46.4351 32.1994 47.038 36.4446 43.3419 35.5012L43.3681 35.475Z" fill="black"/>
<path d="M18.0459 32.1994C17.5216 32.8807 15.2148 32.8283 15.0051 31.9373C14.5857 25.4124 20.1692 19.3067 26.775 19.1757C28.7934 19.1232 30.6546 21.5079 28.8983 22.6347C26.906 23.9449 23.2099 21.7961 20.0643 26.3819C18.675 28.4259 18.7274 31.3346 18.0459 32.2256V32.1994Z" fill="black"/>
<path d="M25.5698 27.43C32.2543 25.5171 32.5689 37.152 25.0718 34.5839C21.6116 33.4047 22.8174 28.2162 25.5698 27.43Z" fill="black"/>
</svg>`,


`<svg width="84" height="84" viewBox="0 0 84 84" fill="none" xmlns="http://www.w3.org/2000/svg">
<path d="M39.9695 6.1015C86.8654 2.95694 91.5052 73.8931 46.0772 77.5879C-2.75855 81.5711 -6.97893 9.24607 39.9695 6.1015ZM37.4268 9.84878C-1.34302 14.8015 2.589 75.8322 43.5345 74.4696C87.2062 73.0021 83.5625 3.95272 37.4268 9.84878Z" fill="black"/>
<path d="M51.4247 51.8287V64.7214C51.4247 67.6039 45.815 71.325 42.9315 71.325C40.415 71.325 34.4383 67.9184 34.4383 65.3503V52.772C32.4723 50.3612 25.3685 56.6765 24.949 52.772C24.6607 49.9943 32.6296 48.6055 34.9102 48.2386C40.0742 47.4001 45.7626 47.4263 50.9266 48.2386C52.814 48.5269 62.513 50.335 62.0674 52.7196L60.4421 54.2395L51.3985 51.8549L51.4247 51.8287ZM41.9878 51.1998C40.6247 51.2784 38.1869 50.6495 37.6626 52.2217C37.8985 57.1482 35.4344 67.6039 42.9315 67.6039C50.4286 67.6039 47.9645 57.1482 48.2004 52.2217C47.6761 50.6495 45.2383 51.2784 43.8752 51.1998V60.9479L42.9315 61.8913L41.9878 60.9479V51.1998Z" fill="black"/>
<path d="M35.6447 39.1718C33.7311 41.8447 29.7991 35.4769 29.0913 35.4769C27.8069 36.2107 25.369 40.4034 23.7438 39.5911C20.1525 37.2326 26.4962 34.2715 26.2079 32.7254C19.0778 26.8032 24.0321 23.842 29.0913 30.4194C29.6943 30.4194 34.8583 22.7677 35.5923 28.7423L31.9486 33.1709C32.8661 34.5598 36.9816 37.3113 35.6185 39.1718H35.6447Z" fill="black"/>
<path d="M61.4652 26.6721C63.4836 28.0872 58.7914 32.3061 57.7167 33.2495C59.3157 35.3983 64.7681 38.0974 59.9972 39.8007L55.5147 35.4507L49.8788 39.8531C46.3138 37.1278 52.9458 34.3763 52.6575 32.6992C51.871 31.2055 48.4371 29.476 48.9351 27.5893C49.8788 23.9992 54.3089 30.5504 55.4623 30.367C56.8254 29.4236 59.6302 25.3619 61.5176 26.6459L61.4652 26.6721Z" fill="black"/>
</svg>`,

      
`<svg width="84" height="84" viewBox="0 0 84 84" fill="none" xmlns="http://www.w3.org/2000/svg">
<path d="M40.5326 6.05714C87.2451 3.72493 90.7839 73.5343 46.6142 77.5436C-3.16528 82.1032 -6.96624 8.44177 40.5326 6.05714ZM38.0161 9.83062C-2.03809 14.4426 2.96867 76.8098 44.1239 74.4252C87.4286 71.9096 83.0509 4.66829 38.0161 9.83062Z" fill="black"/>
<path d="M25.6172 43.661L28.0813 43.2417C31.2269 47.8013 34.8182 52.2561 39.9036 54.7456C41.7647 55.6627 47.7414 56.5013 46.955 59.0169C46.1686 61.5326 41.2143 58.3618 40.0347 58.9907C39.0385 59.5148 36.1288 64.3889 34.7133 65.6729C27.4784 72.2241 18.094 64.3627 22.2881 56.3965C23.258 54.5621 27.0328 50.9197 27.3473 49.4522C27.7667 47.4082 24.8046 45.967 25.6172 43.6872V43.661ZM29.3395 59.9603C29.1823 57.6805 31.2269 56.1868 32.4327 54.5359L30.2832 51.8106C18.4085 62.5022 29.392 71.1759 36.8628 57.1302L34.1104 55.6103C33.1667 55.8462 31.4366 60.3534 29.3395 59.9603Z" fill="black"/>
<path d="M34.4245 35.3801C33.9789 35.0656 33.1663 29.4578 28.9983 29.1695C23.2576 28.7765 23.8605 35.8517 19.2731 35.4325C18.5392 24.8196 34.4508 22.3563 37.2294 32.2617C37.9371 34.8036 36.1546 36.5855 34.4245 35.3539V35.3801Z" fill="black"/>
<path d="M47.6098 35.4065C46.4827 28.2788 55.0283 23.2999 61.1098 27.2568C62.6826 28.2788 67.9253 34.3845 64.8059 35.3803C61.6603 36.1926 62.0535 32.4978 60.1137 30.7683C57.6758 28.6195 54.6088 28.7767 52.3545 31.0827C50.572 32.917 51.1225 36.2713 47.6098 35.4065Z" fill="black"/>
</svg>`,


`<svg width="84" height="84" viewBox="0 0 84 84" fill="none" xmlns="http://www.w3.org/2000/svg">
<path d="M39.954 6.12627C86.483 2.61484 91.5946 73.4724 46.6909 77.6127C-2.3284 82.1461 -7.51867 9.69011 39.954 6.12627ZM37.4113 9.87354C-1.33228 14.8262 2.62594 75.8308 43.519 74.4943C87.348 73.0531 83.5208 4.00369 37.4113 9.87354Z" fill="black"/>
<path d="M42.2606 43.9921C54.5547 43.7301 54.6071 65.2965 44.7509 66.895C29.6257 69.3583 29.6519 44.2804 42.2606 43.9921ZM41.1596 47.556C35.314 48.7352 35.0519 61.7065 40.6616 63.5146C50.5178 66.6592 51.0421 45.5382 41.1596 47.556Z" fill="black"/>
<path d="M56.2588 24.8889C61.3442 24.1551 61.685 35.9735 56.7569 36.1045C51.8287 36.2355 51.1472 25.6226 56.2588 24.8889Z" fill="black"/>
<path d="M31.0937 26.2251C34.1345 29.0814 32.2471 37.5193 27.2927 36.0256C22.3384 34.532 25.5626 21.0365 31.0937 26.2251Z" fill="black"/>
</svg>`,


`<svg width="84" height="84" viewBox="0 0 84 84" fill="none" xmlns="http://www.w3.org/2000/svg">
<path d="M14.1359 25.2811C15.0795 25.3597 17.0193 26.1721 16.8358 27.3251C16.7572 27.8492 12.9562 32.9067 12.1961 34.6624C-0.071869 63.1207 30.5193 91.1074 57.8076 75.8562C75.1871 66.1605 79.8793 42.4714 66.6153 27.4299L69.7609 25.4908C86.4851 45.3801 75.423 77.0878 50.1532 82.6694C16.5213 90.1116 -7.22815 51.9313 14.1359 25.2811Z" fill="black"/>
<path d="M34.3992 0.255672C44.203 -0.609083 67.1661 0.281878 72.802 9.899C80.1417 22.4249 55.9467 27.6658 47.9516 28.2685C39.1962 28.9498 14.975 27.0631 11.0692 17.4984C6.27208 5.70626 26.3778 0.936999 34.373 0.229472L34.3992 0.255672ZM37.5448 3.40024C29.838 3.95054 1.65851 10.5279 19.0905 20.1975C28.8157 25.5956 47.2438 25.7529 57.8078 23.0276C69.6826 19.9616 77.232 12.4933 61.7399 6.5186C54.5311 3.7409 45.1991 2.87614 37.5448 3.40024Z" fill="black"/>
<path d="M56.9429 50.49C65.6195 53.7394 63.4438 67.7589 54.6885 69.5932C51.4905 70.2745 46.5885 69.8553 45.1992 66.4224L46.2478 64.9026C48.5808 64.195 51.4642 68.1782 56.2351 64.8502C61.006 61.5222 59.1972 55.862 55.3438 52.5078L56.9691 50.49H56.9429Z" fill="black"/>
<path d="M64.6238 41.5019H62.2908C61.0849 36.9161 56.8908 33.064 52.4345 36.5492C49.8918 38.5408 50.9403 42.4191 47.1394 41.5281C45.6976 38.4883 49.2889 33.6929 52.1199 32.4613C58.0704 29.8932 66.1704 34.9507 64.6238 41.5019Z" fill="black"/>
<path d="M31.7778 36.7588C29.5496 34.5314 25.5652 34.9507 23.5205 37.2043C23.0225 37.7808 20.2176 44.856 18.8545 40.5323C17.0982 34.9769 29.3137 26.932 35.3953 35.9726C36.9156 38.2263 38.5147 42.2618 34.4778 41.2922C33.3244 40.6895 32.8788 37.8856 31.7778 36.7588Z" fill="black"/>
<path d="M22.5767 18.3106C32.9834 9.50586 50.5203 10.1872 61.5561 17.9962C57.9649 21.167 53.2727 17.1314 48.895 16.2143C43.6261 15.0875 37.8591 15.2447 32.6426 16.7384C28.6582 17.8914 26.9281 20.6691 22.5767 18.3106Z" fill="black"/>
</svg>`,


`<svg width="84" height="84" viewBox="0 0 84 84" fill="none" xmlns="http://www.w3.org/2000/svg">
<path d="M38.8105 6.18986C85.7588 1.83988 91.7879 73.6408 45.5473 77.7025C-0.693287 81.7642 -8.21657 10.566 38.8105 6.18986ZM36.9231 9.93713C25.7299 11.2736 14.7465 20.8383 11.2339 31.425C2.08534 59.0972 30.6056 83.8606 56.7667 70.6534C88.4326 54.6948 74.356 5.42993 36.8969 9.91093L36.9231 9.93713Z" fill="black"/>
<path d="M62.2981 35.4604C61.0923 30.927 56.4001 27.1011 52.1273 30.796C49.9253 32.6827 50.9477 36.3776 47.1467 35.5391C45.9147 27.5204 56.269 22.7512 62.167 28.3852C64.1855 30.3243 67.8292 36.4824 62.2981 35.4604Z" fill="black"/>
<path d="M33.9606 35.4868C33.515 35.1723 32.7024 29.5645 28.5344 29.2763C22.7937 28.8832 23.3966 35.9585 18.8092 35.5392C18.2063 25.3456 33.1742 22.1748 36.5558 31.9492C37.4994 34.6482 35.9791 36.928 33.9344 35.4868H33.9606Z" fill="black"/>
<path d="M64.0539 48.1699C64.6044 54.4066 56.085 62.7397 50.4229 63.7093C48.6142 64.0238 46.8579 63.1852 48.0375 61.2985C48.3521 60.8006 54.5384 57.8919 56.2685 56.3196C59.0472 53.7515 59.9909 50.6594 62.219 47.7769L64.0802 48.1699H64.0539Z" fill="black"/>
</svg>`,


`<svg width="84" height="84" viewBox="0 0 84 84" fill="none" xmlns="http://www.w3.org/2000/svg">
<path d="M71.4136 12.4096C73.5631 10.3657 77.4689 1.66571 80.7194 6.38255C83.9699 11.0994 80.667 25.6954 75.5291 29.3903C85.464 55.857 62.9204 83.0575 35.1079 77.7642C17.0468 74.3313 4.77886 57.6389 6.2206 39.3743C6.37788 37.2517 8.71088 29.8882 8.60603 29.3903C8.50117 28.8924 5.22448 25.6954 4.43808 24.1493C2.57692 20.5069 -0.12307 6.51356 4.77886 5.17712C7.68855 4.39098 10.9915 11.178 13.4293 13.2744C19.0128 18.0698 18.3575 14.768 22.9972 12.1214C37.4409 3.78827 53.3787 5.46537 66.2757 15.7638C67.3767 15.79 70.5223 13.2482 71.4136 12.4096ZM15.0021 18.3057C10.7555 16.8906 8.78952 12.7765 5.56526 10.1298C5.22448 15.528 5.6439 21.2144 9.65457 25.2237L15.0021 18.3319V18.3057ZM38.7778 10.3133C-3.19005 14.5846 2.1575 78.7599 45.5146 74.9078C86.9582 71.213 81.4271 5.98948 38.7778 10.3133ZM78.5437 10.1298L69.1068 18.6463L73.8252 25.2237C76.6039 25.9312 79.4349 12.3834 78.5437 10.1298Z" fill="black"/>
<path d="M27.9781 50.4326C31.3596 49.3058 30.4946 53.1841 31.2285 55.2543C34.2431 63.797 48.0314 64.4783 52.0683 56.2763C52.7236 54.9398 54.0081 47.7073 56.2362 50.9829C57.7828 53.2365 55.2401 58.4775 53.6673 60.3904C47.5333 67.7277 34.5314 67.0202 29.2101 59.1326C28.1091 57.5079 25.5402 51.245 27.9781 50.4326Z" fill="black"/>
<path d="M57.2056 32.0632C57.9396 33.059 60.3512 32.7707 60.1153 36.7801C59.6435 44.7201 49.892 41.2348 52.7755 34.6575L49.394 34.7099C47.559 30.3599 55.0299 30.9626 56.2357 27.1367C58.9357 28.1849 56.9697 31.7225 57.2318 32.0632H57.2056Z" fill="black"/>
<path d="M31.9885 34.6574C32.2506 37.802 31.9885 41.4969 28.0302 41.4707C25.173 40.5273 23.8885 38.0116 24.5438 35.1029C24.8846 33.5306 26.2477 32.9803 26.6147 32.1156C27.2438 30.5695 26.4312 28.7876 27.8992 27.7394L35.7108 33.1638C35.2652 35.3649 33.771 35.3649 31.9885 34.6574Z" fill="black"/>
</svg>`,


`<svg width="84" height="84" viewBox="0 0 84 84" fill="none" xmlns="http://www.w3.org/2000/svg">
<path d="M79.5441 49.5754C75.7169 54.1612 75.2975 57.2009 72.0995 61.944C56.8432 84.48 23.4996 81.9906 10.655 58.1967C9.58025 56.2052 8.74142 52.5103 7.69288 51.0952C6.22492 49.1299 3.05309 48.4486 3.00066 44.4654C2.94823 40.4823 6.04142 39.5914 6.7754 37.9667C8.19093 34.8221 8.40064 29.6336 10.4715 25.467C23.3161 -0.397007 61.2733 -0.501836 74.4587 25.2312C76.6344 29.4763 76.7392 34.7173 78.2334 37.8094C78.8363 39.0411 80.8285 39.8534 81.379 41.5829C82.3227 44.6227 81.5101 47.2431 79.5703 49.5754H79.5441ZM65.9131 43.4959C65.9131 35.5296 62.6626 33.9836 74.0917 35.9489C67.4597 0.808408 18.2307 0.834606 10.5502 35.6345C16.3433 35.8441 20.1181 32.5947 19.3055 40.6134C18.8336 45.0944 16.5268 50.2305 11.8084 51.3835C14.7181 61.944 24.0763 70.6177 34.719 73.1334C51.4956 77.1165 67.4859 67.8662 73.4101 51.96C71.8635 50.5973 70.1859 50.2043 68.7441 48.5272C67.4335 47.0073 66.7781 43.9675 65.9393 43.4697C65.9393 51.8552 59.4121 61.6033 51.6791 64.7479C35.5316 71.3515 20.2491 59.8476 19.6462 43.4173C20.0919 42.7883 20.8783 42.8931 21.5598 42.7883C31.3637 41.5829 52.8587 42.1332 63.1607 42.7883C64.2092 42.8669 65.0218 42.8931 65.9393 43.4434L65.9131 43.4959ZM16.2123 38.4646C11.8346 37.7046 2.79095 41.845 7.40453 46.9549C12.254 52.3531 16.9462 42.9194 16.2123 38.4646ZM68.4296 38.4646C67.4859 43.1028 74.013 52.8247 77.8926 46.3784C81.0907 41.0588 72.4664 37.9667 68.4296 38.4646ZM62.1383 46.6404H23.1326C28.6899 68.7048 56.5811 68.6524 62.1383 46.6404Z" fill="black"/>
<path d="M47.6949 35.2939C47.1182 23.3445 63.1346 22.3749 65.9133 33.774L64.8909 35.2677C61.7453 36.08 62.1385 32.3851 60.1987 30.6556C55.9521 26.9083 51.3648 30.3412 50.2114 35.0318L47.6949 35.2939Z" fill="black"/>
<path d="M34.5094 35.2676C34.0114 34.9269 33.3823 29.4763 29.057 29.0308C23.4211 28.4543 23.9192 35.8178 19.358 35.32C18.7551 25.1263 33.723 21.9556 37.1046 31.7299C38.0483 34.429 36.5279 36.7088 34.4832 35.2676H34.5094Z" fill="black"/>
</svg>`,


`<svg width="84" height="84" viewBox="0 0 84 84" fill="none" xmlns="http://www.w3.org/2000/svg">
<path d="M39.8689 6.12627C86.7386 2.61484 91.326 73.4724 46.6058 77.6127C-2.22999 82.1461 -7.55134 9.6639 39.8689 6.12627ZM37.3262 9.87354C-1.33872 14.8 2.64572 75.857 43.4339 74.4943C87.3415 73.0269 83.462 3.97748 37.3262 9.87354Z" fill="black"/>
<path d="M24.6392 44.3327C25.2946 44.1493 35.1509 47.2153 37.7984 47.4511C43.4605 47.9228 49.0702 47.189 54.575 46.0098C59.6342 44.9354 63.4352 41.6336 60.3944 50.5695C55.6498 64.5366 37.6149 69.3582 28.3878 57.4613C27.0247 55.7056 21.0218 45.4071 24.613 44.3327H24.6392ZM28.047 49.3378C31.2712 61.7064 47.2615 64.9296 54.7323 54.3167C55.4401 53.3209 56.777 50.8053 56.9867 49.6523C57.2488 48.2896 57.0915 48.8137 56.3576 48.9972C46.5799 51.6438 37.9295 51.539 28.047 49.3378Z" fill="black"/>
<path d="M31.0351 35.3445C25.5303 40.5068 22.2011 27.1162 27.2341 25.5702C32.7652 23.8668 33.8137 32.7502 31.0351 35.3445Z" fill="black"/>
<path d="M58.6904 25.6487C62.3078 28.6622 59.503 39.4585 54.4962 35.161C49.9351 31.2565 54.4438 22.111 58.6904 25.6487Z" fill="black"/>
</svg>`,


`<svg width="84" height="84" viewBox="0 0 84 84" fill="none" xmlns="http://www.w3.org/2000/svg">
<path d="M4.38629 5.16003C7.95132 3.98082 10.4154 10.0865 12.7484 12.3139C14.1639 13.6766 15.7892 14.8296 17.5717 15.6157C18.8561 15.7467 24.0726 11.2919 25.9338 10.3748C39.2765 3.77119 55.2405 6.39165 66.5385 15.7467C68.0327 15.7467 72.0171 11.6588 73.1705 10.401C75.1103 8.3308 75.9229 4.63595 79.0948 5.02902C81.0084 5.29106 81.6637 7.51845 81.8996 9.19555C82.8957 16.2708 80.7987 24.1847 75.7919 29.347C92.2802 93.8892 -8.22241 93.8106 8.76394 29.2422C4.54356 25.3377 2.13192 19.2844 2.00085 13.5455C1.97463 11.7374 2.55134 5.73655 4.36007 5.13384L4.38629 5.16003ZM15.2911 18.2886C10.9659 16.9522 9.26199 12.6022 5.85424 10.1127C5.51346 15.5109 5.93287 21.1973 9.94354 25.2066L15.2911 18.3148V18.2886ZM38.4376 10.27C-5.57485 15.2226 4.91055 84.141 49.9191 73.9474C88.2171 65.2736 78.9375 5.68413 38.4376 10.27ZM77.889 10.1127L69.422 18.6555L74.1142 25.1804C75.5297 25.5473 77.6006 20.0967 77.9152 18.9175C78.2297 17.7383 79.7239 10.0079 77.889 10.0865V10.1127Z" fill="black"/>
<path d="M51.1511 60.3995L48.2939 59.7968C47.2715 51.3327 44.6764 48.1357 35.8162 49.1577C33.6405 49.3935 26.7988 52.6953 26.0124 51.5947C25.4095 48.6336 27.4279 48.3191 29.6036 47.3757C41.3997 42.3182 52.121 46.5634 51.1511 60.4257V60.3995Z" fill="black"/>
<path d="M26.4578 22.193C27.5325 23.3461 27.5587 25.1542 29.8131 26.7265C32.0675 28.2987 34.3218 28.1415 36.4189 29.609L35.9471 32.046C30.3636 32.7011 23.8102 28.2201 23.417 22.4813C23.6005 21.5903 25.8024 21.5379 26.4578 22.2193V22.193Z" fill="black"/>
<path d="M58.4644 22.1144C59.6702 21.7213 61.1906 22.1144 61.2168 23.5818C61.2692 27.1457 51.9372 34.1423 48.2936 31.4957C47.245 27.696 52.2518 28.6655 54.8994 26.7002C56.577 25.4686 57.5731 22.4026 58.4906 22.0882L58.4644 22.1144Z" fill="black"/>
<path d="M59.1722 33.5134C62.2392 36.5793 57.6518 42.7899 53.6936 39.3047C49.7354 35.8194 55.8169 30.133 59.1722 33.5134Z" fill="black"/>
<path d="M27.716 32.8322C32.5917 31.9675 33.9548 38.9641 29.9441 40.1433C24.282 41.8204 22.5781 33.7494 27.716 32.8322Z" fill="black"/>
</svg>`,


`<svg width="84" height="84" viewBox="0 0 84 84" fill="none" xmlns="http://www.w3.org/2000/svg">
<path d="M39.2968 7.17251C86.7432 3.03217 91.8024 74.7544 46.0074 78.6589C-1.75356 82.7469 -7.59917 11.2342 39.2968 7.17251ZM36.7541 10.9198C2.78138 15.5056 0.658089 68.2033 36.125 74.7544C85.0394 83.795 88.2112 3.97552 36.7541 10.9198Z" fill="black"/>
<path d="M51.3813 52.2707C51.9842 59.3984 51.958 72.0815 41.7085 71.1119C32.2454 70.2209 33.9493 59.5819 33.5037 52.8735C32.4814 51.4584 20.5542 51.9301 23.228 47.3966C24.329 46.3223 30.7251 48.7331 32.9008 49.0737C42.4425 50.5412 51.9318 49.6241 61.1327 46.8726C67.4764 51.668 52.0104 51.668 51.3551 52.297L51.3813 52.2707ZM37.5406 52.8996V64.5345C37.5406 64.718 39.7425 66.893 40.0571 67.024C42.4949 68.1508 47.6066 66.4475 47.6066 63.9056V52.8996H43.8318L43.2027 61.7044C40.5289 60.3942 42.8881 55.2057 41.6823 53.5023L37.5406 52.9258V52.8996Z" fill="black"/>
<path d="M59.4024 30.3898C63.2295 34.2157 56.0995 40.1642 53.2422 35.4473C50.6471 31.2022 56.5975 27.5597 59.4024 30.3898Z" fill="black"/>
<path d="M27.2904 29.7347C32.2972 28.3197 34.5253 35.3949 30.0166 36.8886C24.4331 38.7491 23.2273 30.8877 27.2904 29.7347Z" fill="black"/>
</svg>`,


`<svg width="84" height="84" viewBox="0 0 84 84" fill="none" xmlns="http://www.w3.org/2000/svg">
<path d="M11.3506 23.1687C16.7506 18.1898 17.7992 13.7349 26.004 9.83043C44.8515 0.894622 59.4262 8.57262 71.5893 22.7494C73.3456 24.7933 75.5213 24.5051 76.1766 28.2261C77.9067 38.0005 78.2213 48.6134 73.9223 57.7589C61.7068 83.7015 24.5622 85.0117 10.3807 60.0386C4.66618 49.976 5.79338 43.8441 6.89435 33.0216C7.1827 30.2177 5.4526 27.9903 8.3623 24.9244C9.35841 23.9024 10.6167 23.85 11.3506 23.1687ZM67.5262 23.3783C57.8272 8.36296 35.3622 5.69011 21.6001 16.7747C19.7652 18.2684 16.7768 21.2033 15.938 23.3783H67.5262ZM11.9798 26.6277C8.23122 28.9075 11.1147 34.4104 13.1594 37.1357C18.0613 43.6345 26.0302 45.3378 32.8719 40.621C35.6505 38.6818 37.0923 35.4324 41.4175 35.4324C46.1097 35.4324 47.001 38.5508 49.9369 40.621C56.5427 45.233 63.9873 43.7917 69.099 37.8433C71.432 35.118 74.4465 30.3487 71.6679 27.0731L11.9798 26.6277ZM72.5592 38.4722C68.5223 46.2812 58.3514 48.6396 50.5398 45.0757C47.3155 43.6083 44.301 39.0749 41.4175 39.0749C38.534 39.0749 35.7292 43.3987 32.7146 44.8923C24.8244 48.7706 14.4176 46.3598 10.2497 38.4984C8.65065 39.1797 8.91278 42.3767 9.01763 43.8179C9.77783 56.7368 18.9788 69.1055 31.3777 73.0362C54.1573 80.2949 75.8358 62.2398 73.8174 38.7866L72.5592 38.4722Z" fill="black"/>
<path d="M59.0853 52.9897C63.1484 51.7056 60.2911 57.3397 58.7183 58.9381C57.3552 60.327 49.229 65.9086 47.6562 63.655C45.9523 61.1918 52.9775 59.0954 54.8649 57.6017C56.0183 56.6845 58.7707 53.0945 59.0853 52.9897Z" fill="black"/>
</svg>`,


`<svg width="84" height="84" viewBox="0 0 84 84" fill="none" xmlns="http://www.w3.org/2000/svg">
<path d="M38.1744 6.24258C85.9878 1.28989 91.781 73.7721 45.5404 77.7552C-0.700232 81.7383 -7.96137 11.038 38.1744 6.24258ZM36.2608 9.98983C25.9065 11.3787 15.4735 20.5503 11.7512 30.1413C0.793938 58.6258 31.7259 85.1973 58.3588 69.8152C88.4519 52.4415 73.1432 4.98475 36.2346 9.96364L36.2608 9.98983Z" fill="black"/>
<path d="M22.9707 25.765C24.9891 25.6602 26.8765 27.3635 27.8202 27.3111C28.7639 27.2586 30.3367 25.8436 31.7784 25.7388C37.2571 25.3719 40.6386 31.399 37.6765 35.9324C37.0736 36.8496 29.026 44.7896 28.4231 44.9468C27.2959 45.2613 26.9027 44.973 26.0115 44.4489C24.2552 43.4007 17.4921 35.9062 17.0727 33.8884C16.26 29.9053 18.8028 26.0008 22.9969 25.7388L22.9707 25.765ZM22.394 29.4074C16.1552 31.1894 25.3299 38.8673 27.3746 40.5969C29.7338 39.3128 39.1444 31.1107 33.4561 29.4336C30.1532 28.4641 29.6289 31.8707 27.925 31.8707C26.4833 31.8707 25.1202 28.6475 22.394 29.4074Z" fill="black"/>
<path d="M51.9362 25.7651C53.7711 25.7389 55.2653 27.2588 56.34 27.3112C57.5983 27.3898 59.1187 25.3196 62.0546 25.9485C67.5594 27.1539 68.5555 32.4211 65.6196 36.8235C64.9905 37.7669 57.9391 44.7897 57.3361 44.9469C56.209 45.2614 55.8158 44.9731 54.9245 44.449C54.2692 44.056 47.3226 37.0855 46.7459 36.2732C43.443 31.5825 46.3265 25.8437 51.9099 25.7651H51.9362ZM50.7041 29.4337C44.9372 31.1371 53.7973 39.4178 56.3138 40.597C58.7517 38.6316 65.7769 33.9147 63.1293 30.613C60.1934 26.9705 57.9391 31.8708 56.2352 31.8708C54.5313 31.8708 54.007 28.4642 50.7041 29.4337Z" fill="black"/>
<path d="M31.8045 52.7296C33.0103 52.3627 51.3074 52.3365 52.3559 52.6772L53.2996 53.6205C55.0821 65.7795 37.8598 70.6012 31.8569 60.591C30.6773 58.6256 28.6327 53.673 31.8045 52.7296ZM49.6297 56.372H33.9016C35.9462 64.5479 48.0569 64.8886 49.6297 56.372Z" fill="black"/>
</svg>`,


`<svg width="84" height="84" viewBox="0 0 84 84" fill="none" xmlns="http://www.w3.org/2000/svg">
<path d="M38.5986 6.22471C86.648 1.45545 92.2053 74.1473 45.3355 77.7373C-1.53422 81.3274 -7.35364 10.7843 38.5986 6.22471ZM36.6851 9.99819C24.3385 11.6753 13.3026 22.9957 10.7075 34.9713C4.7308 62.6172 34.9812 84.2623 59.1762 69.5877C88.7713 51.6636 73.148 5.0455 36.6851 9.99819Z" fill="black"/>
<path d="M55.5325 30.6998C61.0111 29.573 62.4791 36.491 58.2325 37.8537C52.2296 39.819 50.8927 31.6432 55.5325 30.6998Z" fill="black"/>
<path d="M27.2218 30.6999C34.0111 28.6821 34.0111 40.0026 27.2218 37.9848C24.0237 37.0414 24.0237 31.6433 27.2218 30.6999Z" fill="black"/>
</svg>`,


`<svg width="84" height="84" viewBox="0 0 84 84" fill="none" xmlns="http://www.w3.org/2000/svg">
<path d="M38.4577 6.22651C86.7954 1.43105 91.9595 74.3326 45.1946 77.7392C-1.57032 81.1458 -7.23243 10.7599 38.4577 6.22651ZM36.5441 9.9738C26.1111 11.3889 15.783 20.4557 12.0345 30.1252C1.05103 58.6359 32.1665 85.1027 58.6421 69.7991C88.6828 52.4516 73.5314 4.94251 36.5179 9.94761L36.5441 9.9738Z" fill="black"/>
<path d="M26.4787 21.2943C27.5534 22.4211 27.8942 24.7795 30.0962 26.1946C32.2981 27.6096 34.9719 27.1118 36.702 29.0247C35.9156 32.0907 33.3204 31.1735 31.0398 30.597C32.7699 33.0078 32.9272 36.5455 30.4631 38.4846C25.7971 42.1795 23.1496 34.4491 25.3253 30.9901C26.0068 29.9157 28.4447 30.4135 27.8942 28.9985C27.1602 27.1641 22.5991 25.1988 23.4641 21.5302C23.9884 20.5868 25.8234 20.5868 26.5049 21.2681L26.4787 21.2943Z" fill="black"/>
<path d="M56.2043 29.3128C63.5965 30.1514 59.114 42.9131 53.9762 38.1438C51.6956 36.0212 52.0626 32.9815 53.6616 30.5968L49.048 31.1472L47.9733 28.9983C47.9471 27.3212 51.8791 27.5309 53.6616 26.4565C55.2868 25.4869 60.1888 17.3373 61.1325 22.1589C61.5781 24.3863 55.916 28.8935 56.2043 29.2866V29.3128Z" fill="black"/>
<path d="M46.8985 52.7137C44.9325 54.7053 40.2665 63.4053 38.0384 59.0553C37.619 57.4568 44.5131 50.6174 45.9548 48.9141C47.2131 48.521 61.08 50.6698 62.1286 51.3773C62.7053 51.7704 63.1771 52.0848 63.1509 52.871L62.0762 54.3647L46.8985 52.7137Z" fill="black"/>
</svg>`,


`<svg width="84" height="84" viewBox="0 0 84 84" fill="none" xmlns="http://www.w3.org/2000/svg">
<path d="M52.3012 72.4622C53.5332 79.4326 45.9838 83.835 41.2391 78.0438C40.7148 77.3887 40.4003 75.7902 40.1906 75.6592C39.5877 75.2923 37.2284 75.7378 35.8391 75.2923C34.6595 74.9254 27.7129 71.4926 26.0091 70.6541C-18.9995 47.987 20.1635 -19.8046 62.4983 9.02059C86.9292 25.6606 80.6904 64.6794 52.275 72.4884L52.3012 72.4622ZM52.2488 68.6363C83.7574 59.2288 80.3234 12.1914 48.0022 6.53116C14.7897 0.713711 -4.52967 42.5888 22.0508 63.9195C22.9421 64.627 32.1168 70.8637 32.1168 67.6929V50.7123C30.8061 49.2186 27.844 50.293 28.3421 47.5677L29.2858 46.6244H55.709L56.6527 47.5677L56.0497 49.4544L52.2488 49.7427V68.6101V68.6363ZM49.1032 74.611V50.7123L48.1595 49.7689H35.2624V70.2086C35.2624 71.8333 37.7527 72.8028 39.2993 71.7284C40.6624 70.7589 40.1906 69.0818 43.4673 69.8941C43.5197 71.7809 43.2313 73.7462 43.7294 75.6068C44.5682 78.6465 48.5265 77.3101 49.1032 74.611Z" fill="black"/>
<path d="M52.2494 30.8754C53.6125 31.4519 58.96 34.4392 59.4843 35.2778C60.5328 37.0073 59.5629 39.025 57.3086 38.1079C55.8144 37.5052 46.6397 31.1374 46.7445 29.932C49.3397 27.3377 53.796 23.7739 57.0727 22.1754C57.9377 21.7561 58.8028 20.9962 59.8251 21.7299C63.6785 24.1408 50.9125 28.8838 52.2756 30.8492L52.2494 30.8754Z" fill="black"/>
<path d="M36.3899 31.4255C36.0754 31.9496 26.9531 37.6884 26.2453 37.9767C25.59 38.2387 25.3803 38.5532 24.5676 38.1601C20.0851 35.9327 30.5181 31.7138 31.4618 29.9581C31.4618 29.3291 23.6764 24.9792 23.4142 24.5075C22.6278 23.171 23.4667 21.2581 25.354 21.5464C26.1929 21.6774 36.1278 28.7002 36.3899 29.4602C36.5996 30.0367 36.7045 30.9014 36.3899 31.4255Z" fill="black"/>
</svg>`,


`<svg width="84" height="84" viewBox="0 0 84 84" fill="none" xmlns="http://www.w3.org/2000/svg">
<path d="M39.2837 7.19617C86.3894 2.76757 92.1564 74.7519 46.0206 78.7088C-1.55689 82.7706 -7.76949 11.651 39.2837 7.19617ZM19.912 32.1693H38.4711C39.1789 32.1693 40.0439 34.3443 38.8119 35.0256C37.1342 36.1786 32.2061 34.1346 31.3935 36.3358L31.3411 72.6293C37.6323 77.0317 46.2303 75.2498 53.2555 73.6775V35.3138L46.309 35.0256L45.7061 33.1388L46.6497 32.1955H65.2089L64.5798 65.5279C66.1002 66.4188 70.9497 58.5312 71.605 57.1424C79.8623 39.8997 71.4215 19.2504 53.5701 12.673C20.777 0.618815 -4.99086 41.996 19.8858 66.1568V32.1955L19.912 32.1693ZM28.7197 35.3138H23.0576V69.2751L28.7197 71.7908V35.3138ZM62.0633 35.3138H56.4012V71.7908H57.3449L62.0633 68.3317V35.3138Z" fill="black"/>
<path d="M47.3575 49.3597C53.3866 55.0986 46.9643 67.2051 38.8119 62.6193C29.1915 57.2211 38.943 41.3411 47.3575 49.3597ZM39.5721 59.0555C45.1818 64.3226 50.5293 50.3293 41.6692 51.0892C37.9993 51.4037 37.2915 56.9067 39.5721 59.0555Z" fill="black"/>
</svg>`,


`<svg width="84" height="84" viewBox="0 0 84 84" fill="none" xmlns="http://www.w3.org/2000/svg">
<path d="M39.2841 6.1483C87.0713 2.32242 91.5276 73.7564 45.9948 77.6347C-2.02836 81.7489 -7.34971 9.86937 39.2841 6.1483ZM36.7414 9.89556C2.76871 14.4814 0.645415 67.179 36.1123 73.7302C84.9743 82.7708 88.2247 2.95131 36.7414 9.89556Z" fill="black"/>
<path d="M40.5422 44.4858C44.3956 44.1452 49.1927 45.2458 52.5742 47.2111C54.7237 48.4427 61.8014 54.234 59.8878 56.933C57.9742 59.6321 55.3791 53.6313 54.1995 52.5045C47.8558 46.4774 37.2918 46.6346 30.8957 52.5045C29.585 53.6837 27.1996 58.0861 25.5743 57.2737C22.8219 55.9111 26.7801 51.5611 28.0646 50.3033C31.0267 47.4207 36.4005 44.9051 40.5422 44.512V44.4858Z" fill="black"/>
<path d="M27.9335 27.4266C32.783 26.7191 33.4646 38.5112 28.4316 38.6422C23.3986 38.7732 22.8219 28.1603 27.9335 27.4266Z" fill="black"/>
<path d="M54.9594 27.4528C60.8574 25.6709 61.8798 37.332 56.6895 38.0657C51.0536 38.8781 51.3681 28.5272 54.9594 27.4528Z" fill="black"/>
<path d="M51.7092 17.9142C52.784 17.5998 56.7947 21.1898 58.2888 22.0022C59.9665 22.9193 66.1267 24.5178 65.8121 26.326C64.3704 29.2085 59.4684 26.6928 57.2403 25.566C55.8248 24.8585 47.1481 19.2245 51.7092 17.9142Z" fill="black"/>
<path d="M32.2851 18.0191C33.7268 17.626 34.6705 18.6218 34.2773 20.0107C33.4647 22.8932 24.1851 27.7935 21.3541 27.8459C19.8599 27.8721 18.3657 25.6185 19.9123 24.5179C22.4288 23.9938 24.5521 23.2076 26.8327 22.0022C28.3268 21.2161 31.787 18.1239 32.2851 17.9929V18.0191Z" fill="black"/>
</svg>`,


`<svg width="84" height="84" viewBox="0 0 84 84" fill="none" xmlns="http://www.w3.org/2000/svg">
<path d="M39.272 6.19617C86.3776 1.76757 92.1708 73.7519 46.0088 77.7088C-1.59488 81.7705 -7.72884 10.6248 39.272 6.19617ZM37.3846 9.96961C-0.939541 14.5554 2.41579 75.0359 42.837 74.5904C86.5873 74.1187 84.6213 4.30939 37.3846 9.96961Z" fill="black"/>
<path d="M38.6168 40.7601C50.6226 38.8734 61.2128 47.3899 61.1604 59.5227L24.278 59.8372C21.7091 58.029 26.9518 48.8836 28.4722 46.9706C30.8052 44.0095 34.8945 41.3628 38.643 40.7863L38.6168 40.7601ZM27.4498 56.9546H56.7041L57.4119 55.6444C52.4051 39.2927 31.0411 40.2884 27.4498 56.9546Z" fill="black"/>
<path d="M56.2063 24.9849C61.3966 24.1988 61.816 35.1786 56.7044 36.2006C51.5403 35.5716 51.2258 25.7449 56.2063 24.9849Z" fill="black"/>
<path d="M26.3753 35.3881C23.4656 33.0297 24.3044 23.8318 30.15 25.6399C34.8947 27.1074 31.8539 39.8691 26.3753 35.3881Z" fill="black"/>
</svg>`,


`<svg width="84" height="84" viewBox="0 0 84 84" fill="none" xmlns="http://www.w3.org/2000/svg">
<path d="M39.9538 6.10049C86.6138 2.98213 91.3585 73.4466 46.6907 77.5869C-2.80041 82.1727 -7.09943 9.24505 39.9538 6.10049ZM37.4111 9.84776C-1.54216 14.8267 2.52093 76.4601 44.148 74.4423C85.775 72.4246 83.2061 3.97791 37.4111 9.84776Z" fill="black"/>
<path d="M49.2858 63.5412C40.1373 72.1626 29.2324 57.75 35.7596 47.1895C39.7178 40.8218 47.6081 41.5555 51.0945 48.0019C53.5586 52.5615 53.1391 59.8988 49.2596 63.5412H49.2858ZM42.4178 46.2461C35.5237 47.504 35.4975 62.8861 43.5188 62.5455C52.012 62.2048 50.3343 44.8049 42.4178 46.2461Z" fill="black"/>
<path d="M56.442 32.3053C59.2731 32.2529 60.4527 33.5632 60.2692 36.3933C59.9022 42.0273 49.81 39.5902 53.2964 33.5631C52.6935 33.1177 46.7955 35.5547 48.3421 31.4406C48.709 30.471 52.7721 30.0255 54.5284 28.7939C56.6255 27.3264 57.9362 23.0551 59.7974 23.553C64.6731 24.8632 56.0488 31.9123 56.442 32.2791V32.3053Z" fill="black"/>
<path d="M31.9065 33.5894C34.423 45.8532 17.3842 37.3104 28.7609 32.0171C26.69 31.4668 21.4735 24.4963 24.6716 23.5267C26.6114 22.924 27.9745 27.4837 30.0454 28.8463C32.6143 30.5234 39.5609 30.3662 35.2618 34.1659L31.9065 33.5894Z" fill="black"/>
</svg>`,


`<svg width="84" height="84" viewBox="0 0 84 84" fill="none" xmlns="http://www.w3.org/2000/svg">
<path d="M18.4203 5.04209C20.832 4.41318 24.2397 11.0168 25.9174 12.4843C47.36 2.1072 73.023 15.3406 77.0599 38.7152C82.5123 70.5015 46.2853 92.6182 20.2028 73.5412C6.67666 63.6358 2.74463 46.0525 8.6951 30.6179C9.29801 29.0456 11.2378 26.6348 11.4213 25.7963C11.6048 24.9577 9.92714 21.9966 9.87471 20.3457C9.69122 15.1571 14.4621 8.23909 18.4203 5.06832V5.04209ZM18.9184 8.7632C13.9378 12.2746 9.08831 26.2679 18.9184 26.2679C28.7484 26.2679 24.03 12.3794 18.9184 8.7632ZM13.6495 28.2857C2.69221 47.7296 13.5184 72.2048 35.4853 76.4761C64.1629 82.0577 84.9764 49.6949 67.9638 25.77C59.1299 13.349 41.4882 8.63216 27.7261 15.6288C26.6251 17.2535 29.3513 23.202 25.0785 26.9755C21.5135 30.0938 17.765 29.229 13.6757 28.2595L13.6495 28.2857Z" fill="black"/>
<path d="M58.6581 51.7126C63.796 57.006 59.6542 64.7887 52.7339 65.8107C48.33 66.4658 34.699 66.5444 30.4 65.8107C20.2291 64.1074 20.7272 50.6382 29.7708 49.1183C34.1747 48.3846 47.6484 48.4632 52.262 48.9611C54.1494 49.1707 57.3474 50.3499 58.6581 51.6864V51.7126ZM33.7029 52.7608C23.6107 51.3719 23.6107 63.5833 33.7029 62.1945V52.7608ZM48.1727 52.7608H35.5902V62.1945H48.1727V52.7608ZM50.0601 62.1945C59.3659 63.5309 59.9164 51.2409 50.0601 52.7608V62.1945Z" fill="black"/>
<path d="M54.3327 30.2509C58.6579 29.6744 63.586 33.0548 64.7656 37.1952C65.1588 38.6102 64.5297 40.4184 63.0356 40.1563C61.2268 39.8419 60.7812 33.2907 54.7783 33.841C50.7152 34.2078 49.955 41.0997 47.5434 39.8942C43.7162 37.9551 50.4269 30.775 54.3327 30.2247V30.2509Z" fill="black"/>
<path d="M34.1219 32.8452C35.118 33.841 38.4471 39.4226 35.8782 40.1825C32.6802 41.1259 33.7025 34.2341 28.3287 33.8672C22.0113 33.4217 22.6404 39.5536 20.7268 40.1301C17.0569 41.2569 18.9443 35.5443 20.5695 33.6838C24.0821 29.6745 30.2161 28.9931 34.0957 32.8452H34.1219Z" fill="black"/>
</svg>`,

  ];

  // --- Choisir al√©atoirement un SVG
  const randomSVG = SHAPES[Math.floor(Math.random() * SHAPES.length)];

  // --- Cr√©ation du canvas
  const canvas = document.createElement('canvas');
  canvas.className = 'confetti-canvas';
  Object.assign(canvas.style, {
    position: 'fixed',
    top: '0',
    left: '0',
    width: '100%',
    height: '100%',
    pointerEvents: 'none',
    zIndex: 3000,
  });
  document.body.appendChild(canvas);
  const ctx = canvas.getContext('2d');

  // --- Origine du tir
  const rect = originEl.getBoundingClientRect();
  const originX = rect.left + rect.width / 2;
  const originY = rect.top + rect.height / 2;

  // --- Image √† partir du SVG color√©
  const colored = randomSVG.replace(/fill="black"/g, `fill="${color}"`);
  const blob = new Blob([colored], { type: 'image/svg+xml;charset=utf-8' });
  const url = URL.createObjectURL(blob);
  const img = new Image();
  img.src = url;

  // --- Particules
  const particles = [];
  const total = 20;
  for (let i = 0; i < total; i++) {
    particles.push({
      x: originX,
      y: originY,
      size: Math.random() * 45 + 35,
      vx: (Math.random() - 0.5) * 12,
      vy: (Math.random() - 0.5) * 12 - 5,
      rotation: Math.random() * 10,
      rotationSpeed: (Math.random() - 0.5) * 2,
      life: Math.random() * 100 + 80,
    });
  }

  // --- Animation
  let frame = 0;
  function animate() {
    ctx.clearRect(0, 0, canvas.width, canvas.height);
    if (!img.complete) {
      requestAnimationFrame(animate);
      return;
    }

    particles.forEach((p) => {
      p.x += p.vx;
      p.y += p.vy;
      p.vy += 0.2; // gravit√©
      p.rotation += p.rotationSpeed;
      p.life--;

      ctx.save();
      ctx.translate(p.x, p.y);
      ctx.rotate((p.rotation * Math.PI) / 180);
      ctx.drawImage(img, -p.size / 2, -p.size / 2, p.size, p.size);
      ctx.restore();
    });

    frame++;
    if (particles.some((p) => p.life > 0) && frame < 300) {
      requestAnimationFrame(animate);
    } else {
      canvas.remove();
      URL.revokeObjectURL(url);
    }
  }

  const resize = () => {
    canvas.width = window.innerWidth;
    canvas.height = window.innerHeight;
  };
  resize();
  window.addEventListener('resize', resize);
  animate();
}








	let scrollContainer = $state(null);

	import { register } from 'swiper/element/bundle';
	register();
	let swiperEl = $state(null);

	onMount(() => {
		if (swiperEl) {
			Object.assign(swiperEl, {
				slidesPerView: 1,
				speed: 500,
				loop: true,
				pagination: {
					clickable: true
				},
				navigation: true
			});
			// Appliquer les variables CSS
			swiperEl.style.setProperty('--swiper-navigation-color', currentPiece.color);
			swiperEl.style.setProperty('--swiper-navigation-size', '0');
			swiperEl.style.setProperty('--swiper-pagination-bullet-inactive-opacity', '1');
			swiperEl.style.setProperty('--swiper-pagination-bullet-inactive-color', 'white');
			swiperEl.style.setProperty('--swiper-pagination-color', 'black');
			swiperEl.style.setProperty('--swiper-pagination-bullet-size', '10px');

			swiperEl.initialize();
		}

	});



	// ‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî
	// CONSTANTES
	// ‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî
	// const LABELS = ["L'oeuvre", "D'apr√®s toi...", 'La Couleur'];
	// const OFFSET = 90;
	// const SCROLL_MS = 800;

	let gsap;
	let gsapReady;
	let circleEl = $state(null);

	onMount(async () => {
		// Import scroll freeze utility and unfreeze scroll for indices page
		const { unfreezeScroll, freezeScroll } = await import('$lib/utils/scrollFreeze.js');
		unfreezeScroll();

		gsapReady = import('gsap').then((m) => (gsap = m.gsap ?? m.default ?? m));
		piecesStore.initialize();
		hasInitialized = true;

		// Return cleanup function to restore scroll freeze when leaving this page
		return () => {
			freezeScroll();
		};
	});

	async function expand() {
		if (!gsap) await gsapReady;
		if (circleEl) gsap.to(circleEl, { scale: 9, duration: 3, ease: 'power3.out' });
	}
	async function shrink() {
		if (!gsap) await gsapReady;
		if (circleEl) gsap.to(circleEl, { scale: 1, duration: 4, ease: 'elastic.out(1, 0.3)' });
	}

	let active = $state(0);
	let hasInitialized = $state(false);

	let pieceId = $derived(page.params.id);
	let currentPiece = $derived(PIECES_DATA[pieceId]);
	let totalPiece = $derived(Number($piecesStore?.length ?? 0));

	

	function navigateToPiece(id) {
		goto(`/indices/${id}`);
		scrollContainer.scrollTo(0, 0);	
	}



	let selected = $state(new Set());
	function toggle(i) {
		const s = new Set(selected);
		s.has(i) ? s.delete(i) : s.add(i);
		selected = s;
	}
	$effect(() => {
		pieceId;
		selected = new Set();
	});

	let selectedAnswer = $state(null);
	function toggleAnswer(i) {
		selectedAnswer = selectedAnswer === i ? null : i;
	}
	$effect(() => {
		pieceId;
		selectedAnswer = null;
	});
</script>

<!-- VERSION SVELTE 5 (√©v√©nements corrig√©s) -->

{#if currentPiece}
<div bind:this={scrollContainer} class="scroll-container">
	<div class="p-5 pt-0 pb-22" id="section-0">
		<!-- Header / onglets -->
		<header class="sticky left-5 top-0 z-10 flex items-center pt-4 pb-2 bg-white">
			<a href="/start" class="flex gap-2" aria-label="Retour au Chromogram">
				<img
					src="/images/retour_chromo.svg"
					alt="retour"
					class="h-auto !w-[162px]"
				/>
			</a>
		</header>

		<!-- Swiper -->
		<div class="mb-4 w-full">
			<swiper-container bind:this={swiperEl}>
				{#each currentPiece.images as img, i (i)}
					<swiper-slide>
						<img
							class="object-contain"
							src={img.src}
							alt={img.credits ?? `image ${i + 1}`}
						/>
						{#if img.credits}
							<p class="text-mini text-right italic pt-1 py-0 px-1">{img.credits}</p>
						{/if}
					</swiper-slide>
				{/each}
			</swiper-container>
		</div>

		<!-- Infos ≈ìuvre -->
		<div class="flex flex-col">
			<h2 class="text-dixsept whitespace-pre-line uppercase italic">
				{currentPiece.titre_artwork}
			</h2>
			<p>{currentPiece.artiste} - {currentPiece.date}</p>
			<p class="mt-3">{@html currentPiece.story}</p>
		</div>

		<!-- Bloc "D'apr√®s toi..." -->
		<div class="relative mt-15 mb-16 bg-black border-white border px-5 py-6 pb-10 text-white" id="section-1">
			<img
				src="/images/aro_dapres_bas.svg"
				alt="indic"
				class="absolute right-5 bottom-2 h-auto !w-[97.9px]"
			/>
			<div class="text-titre-alt inf-bold bah mb-4">{currentPiece.dapres_toi}</div>

			{#if Array.isArray(currentPiece?.dapres) && currentPiece.dapres.length}
				{#each currentPiece.dapres as line, i (i)}
					<div
						class="flex cursor-pointer touch-none items-center gap-2 select-none"
						class:selected={selected.has(i)}
						onclick={() => {
							toggle(i);
							triggerConfetti(document.getElementById('section-1'), currentPiece.color);
						}}
					>
				<!-- Pseudo-case synchronis√©e -->
						<div class="pseudo-checkbox" class:checked={selected.has(i)}>
							<svg
								width="15"
								height="15"
								viewBox="0 0 15 15"
								fill="#fff"
								xmlns="http://www.w3.org/2000/svg"
							>
								<path
									d="M13.025 2.88117c-.3193-.31937-.6983-.57272-1.1155-.74557C11.4924 1.96275 11.0453 1.87378 10.5937 1.87378c-.4516 0-.89868.08897-1.31585.26182-.41716.17285-.79617.4262-1.1154.74557l-.6625.6625-.6625-.6625C6.19264 2.23636 5.3181 1.87411 4.4062 1.87411s-1.78644.36225-2.43125 1.00706C1.33014 3.52598.967896 4.40052.967896 5.31242c0 .9119.362244 1.78644 1.007054 2.43125l5.525 5.525 5.525-5.525c.3193-.31922.5727-.69824.7455-1.1154.1729-.41717.2618-.8643.2618-1.31585 0-.45155-.0889-.89869-.2618-1.31585-.1728-.41716-.4262-.79618-.7455-1.1154Z"
								/>
							</svg>
						</div>

						<span class:underline={selected.has(i)}>{line}</span>
						<!-- {#if selected.has(i)}
							<svg
								width="15"
								height="15"
								viewBox="0 0 15 15"
								fill="#fff"
								class="shrink-0"
							>
								<path
									d="M13.025 2.88117c-.3193-.31937-.6983-.57272-1.1155-.74557C11.4924 1.96275 11.0453 1.87378 10.5937 1.87378c-.4516 0-.89868.08897-1.31585.26182-.41716.17285-.79617.4262-1.1154.74557l-.6625.6625-.6625-.6625C6.19264 2.23636 5.3181 1.87411 4.4062 1.87411s-1.78644.36225-2.43125 1.00706C1.33014 3.52598.967896 4.40052.967896 5.31242c0 .9119.362244 1.78644 1.007054 2.43125l5.525 5.525 5.525-5.525c.3193-.31922.5727-.69824.7455-1.1154.1729-.41717.2618-.8643.2618-1.31585 0-.45155-.0889-.89869-.2618-1.31585-.1728-.41716-.4262-.79618-.7455-1.1154Z"
								/>
							</svg>
						{/if} -->
					</div>
				{/each}
			{/if}
		</div>

		<!-- Bloc Couleur (GSAP press & hold) -->
		<div
			id="section-2"
			class="relative overflow-hidden border px-5 py-4"
			onpointerdown={(e) => { e.preventDefault(); expand(e); }}
			onpointerup={shrink}
			onpointerleave={shrink}
			onpointercancel={shrink}
		>
			<div class="text-titre-alt inf-bold relative z-[1] mb-5 uppercase">
				{currentPiece?.color_name}
			</div>

			<div class="flex items-center gap-5">
				<div
					bind:this={circleEl}
					class="relative z-0 h-20 w-20 border border-white origin-center touch-none rounded-full select-none"
					style="background-color: {currentPiece?.color};"
				/>
				<div class="relative z-[1] leading-6">
					<span class="inf-bold">hexad√©cimale</span> : {currentPiece?.color}<br /><br />
					<span class="inf-bold">rvb</span> : {currentPiece?.rvb}<br /><br />
					<span class="inf-bold">cmjn</span> : {currentPiece?.cmjn}
				</div>
			</div>
		</div>

		<!-- Progress / navigation par couleurs -->
		<div class="m-auto mt-17 mb-10 h-px w-2/3 bg-black"></div>

		<div class="flex justify-center gap-[4vw]">
			{#each PIECES_ENTRIES as [id, data] (id)}
				<span
					class="rounded-full px-[3vw] py-[3vw] border-white border"
					style="background-color: {foundPieces.includes(id) ? data.color : '#E3E3E3'}"
					title={data.color_name}
					onclick={() => foundPieces.includes(id) && navigateToPiece(id)}
				/>
			{/each}
		</div>

		<div class="mt-5 mb-15 text-center text-titre-alt">
			<p>
				{#if totalPiece === 0}
					Tu n'as d√©couvert aucune couleur
				{:else if totalPiece === 1}
					Tu as d√©j√† d√©couvert 1 couleur sur 7 !
				{:else if totalPiece === 7}
					Bravo, Tu as d√©couvert toutes les couleurs !
				{:else}
					Tu as d√©j√† d√©couvert {totalPiece} couleurs sur 7 !
				{/if}
			</p>
		</div>

		{#if totalPiece !== 7}
			<div class="relative flex items-center justify-center">
				<div class="relative inline-block">
					<a href="/scanner" class="block">
						<svg width="52" height="43" viewBox="0 0 52 43" fill="none" xmlns="http://www.w3.org/2000/svg">
							<g clip-path="url(#clip0_2041_26)">
								<path d="M48 5H45V0H31V5H20V2H9V5H4C1.79 5 0 6.79 0 9V39C0 41.21 1.79 43 4 43H48C50.21 43 52 41.21 52 39V9C52 6.79 50.21 5 48 5ZM26.5 38C19.04 38 13 31.96 13 24.5C13 17.04 19.04 11 26.5 11C33.96 11 40 17.04 40 24.5C40 31.96 33.96 38 26.5 38Z" fill="black"/>
								<path d="M26.5 34C31.7467 34 36 29.7467 36 24.5C36 19.2533 31.7467 15 26.5 15C21.2533 15 17 19.2533 17 24.5C17 29.7467 21.2533 34 26.5 34Z" fill="black"/>
							</g>
						</svg>
					</a>
					<div class="absolute top-1/2 right-full -translate-y-1/2 pr-2">
						<img
							src="/images/indic_camera_oeuvre.svg"
							alt="gauche"
							class="pointer-events-none mr-2 h-auto !w-[116.556px] max-w-none"
						/>
					</div>
				</div>
			</div>
		{:else}
			<div class="mx-auto w-fit">
				<a href="/puzzles" class="text-bouton inf-bold z-10 border bg-white px-[15px] py-[7px] tracking-[4%] drop-shadow-[var(--my-drop-shadow)]">
					ACC√àDE AUX TANGRAMS
				</a>
			</div>
		{/if}
	</div>
</div>
{/if}


<style>

	.scroll-container {
		height: 100vh;
		overflow-y: auto;
		overflow-x: hidden;
		scroll-behavior: auto; /* on g√®re le smoothScroll manuellement */
	}
	.bah::first-line {
		padding-right: 40px !important;
	}
	.swiper-button-next svg,
	.swiper-button-prev svg {
		width: 15px !important;
		height: auto !important;
	}
	.swiper-button-prev,
	.swiper-button-next {
		color: red; /* Couleur de la fl√®che (SVG currentColor) */
		font-size: 15px; /* Modifie la taille de l'ic√¥ne fl√®che */
		width: 24px;
		height: 24px;
	}

	.pseudo-checkbox {
		width: 15px;
		height: 15px;
		border: 1px solid white;
		display: flex;
		align-items: center;
		justify-content: center;
		transition: all 0.25s ease;
	}

	.pseudo-checkbox svg {
		opacity: 0;
		transform: scale(0.6);
		transition: all 0.25s ease;
	}

	.pseudo-checkbox.checked {
		border-color: #ffffff65;
		background-color: transparent;
	}

	.pseudo-checkbox.checked svg {
		opacity: 1;
		transform: scale(1);
	}

  input[type="checkbox"] {
    display: none;
  }

  input[type="checkbox"]:checked + .pseudo-checkbox {
    background-color: transparent; /* tu peux changer en #fff si tu veux fond plein */
  }

  input[type="checkbox"]:checked + .pseudo-checkbox svg {
    opacity: 1;
    transform: scale(1);
  }
</style>
