<script>
	import { goto } from '$app/navigation';
	import { page } from '$app/state';
	import { onMount } from 'svelte';
	import { piecesStore } from '$lib/piecesStore.js';
	import { PIECES_DATA } from '$lib/piecesData';

	
	const PIECES_ENTRIES = Object.entries(PIECES_DATA);

	let foundPieces = $derived($piecesStore);

// --- ðŸŽ‰ EFFET DE PAILLETTES AVEC 2 SVG ALÃ‰ATOIRES MONOCOULEUR ---
function triggerConfetti(originEl, color = '#FF0000') {
  if (!originEl) return;

  // Les deux SVG possibles
  const SHAPES = [
    // SVG 1
    	`<svg width="73" height="85" viewBox="0 0 73 85" fill="none" xmlns="http://www.w3.org/2000/svg">
    	<path d="M8.63048 26.051C9.57417 26.1296 11.514 26.942 11.3305 28.095C11.2518 28.6191 7.45087 33.6766 6.69068 35.4323C-5.57724 63.8906 25.0139 91.8773 52.3022 76.6261C69.6817 66.9304 74.374 43.2413 61.1099 28.1998L64.2555 26.2607C80.9798 46.15 69.9177 77.8577 44.6478 83.4393C11.0159 90.8815 -12.7335 52.7012 8.63048 26.051Z" fill="black"/>
      	<path d="M28.8938 1.02557C38.6977 0.160814 61.6607 1.05178 67.2966 10.6689C74.6364 23.1948 50.4413 28.4357 42.4462 29.0384C33.6909 29.7197 9.46959 27.833 5.56378 18.2683C0.76671 6.47615 20.8725 1.7069 28.8676 0.999369L28.8938 1.02557ZM32.0394 4.17014C24.3327 4.72044 -3.84686 11.2978 13.5851 20.9674C23.3103 26.3655 41.7384 26.5228 52.3025 23.7975C64.1772 20.7315 71.7267 13.2632 56.2345 7.28849C49.0258 4.51079 39.6938 3.64604 32.0394 4.17014Z" fill="black"/>
      	<path d="M51.4375 51.2599C60.1142 54.5093 57.9384 68.5288 49.1831 70.3631C45.9851 71.0444 41.0832 70.6252 39.6938 67.1923L40.7424 65.6725C43.0754 64.9649 45.9589 68.9481 50.7297 65.6201C55.5006 62.2921 53.6919 56.6319 49.8385 53.2777L51.4637 51.2599H51.4375Z" fill="black"/>
      	<path d="M59.1184 42.2718H56.7854C55.5796 37.686 51.3854 33.8339 46.9291 37.3191C44.3864 39.3107 45.435 43.189 41.634 42.298C40.1923 39.2582 43.7835 34.4628 46.6146 33.2312C52.565 30.6631 60.665 35.7206 59.1184 42.2718Z" fill="black"/>
      	<path d="M26.2724 37.5287C24.0443 35.3013 20.0598 35.7206 18.0152 37.9742C17.5171 38.5507 14.7123 45.6259 13.3492 41.3022C11.5929 35.7468 23.8084 27.7019 29.8899 36.7425C31.4103 38.9961 33.0093 43.0317 28.9724 42.0621C27.819 41.4594 27.3734 38.6555 26.2724 37.5287Z" fill="black"/>
      	<path d="M17.0713 19.0805C27.4781 10.2758 45.0149 10.9571 56.0508 18.7661C52.4595 21.9369 47.7673 17.9013 43.3897 16.9842C38.1207 15.8574 32.3538 16.0146 27.1373 17.5083C23.1528 18.6613 21.4227 21.439 17.0713 19.0805Z" fill="black"/>
    	</svg>`,

    // SVG 2
    	`<svg width="72" height="73" viewBox="0 0 72 73" fill="none" xmlns="http://www.w3.org/2000/svg">
    	<path d="M32.5435 0.964232C79.6492 -3.46436 85.4162 68.52 39.2804 72.4769C-8.29712 76.5386 -14.5097 5.41903 32.5435 0.964232ZM13.1717 25.9374H31.7309C32.4387 25.9374 33.3037 28.1123 32.0717 28.7937C30.394 29.9467 25.4659 27.9027 24.6532 30.1039L24.6008 66.3974C30.8921 70.7998 39.4901 69.0179 46.5153 67.4456V29.0819L39.5687 28.7937L38.9658 26.9069L39.9095 25.9635H58.4687L57.8395 59.2959C59.3599 60.1869 64.2094 52.2993 64.8648 50.9104C73.122 33.6677 64.6813 13.0184 46.8299 6.44105C14.0368 -5.61312 -11.7311 35.7641 13.1455 59.9248V25.9635L13.1717 25.9374ZM21.9795 29.0819H16.3174V63.0432L21.9795 65.5589V29.0819ZM55.323 29.0819H49.6609V65.5589H50.6046L55.323 62.0998V29.0819Z" fill="black"/>
    	<path d="M40.6173 43.1278C46.6464 48.8666 40.2241 60.9732 32.0717 56.3874C22.4513 50.9892 32.2027 35.1092 40.6173 43.1278ZM32.8319 52.8235C38.4415 58.0907 43.7891 44.0973 34.9289 44.8573C31.259 45.1717 30.5513 50.6747 32.8319 52.8235Z" fill="black"/>
    	</svg>`,

	// SVG 3
		`<svg width="73" height="73" viewBox="0 0 73 73" fill="none" xmlns="http://www.w3.org/2000/svg">
		<path d="M6.27983 17.4948C11.6798 12.5159 12.7284 8.0611 20.9332 4.1566C39.7807 -4.77921 54.3554 2.89879 66.5185 17.0755C68.2748 19.1195 70.4505 18.8312 71.1058 22.5523C72.8359 32.3267 73.1505 42.9396 68.8515 52.085C56.636 78.0277 19.4914 79.3379 5.30993 54.3648C-0.404617 44.3022 0.722579 38.1703 1.82355 27.3478C2.11189 24.5439 0.381797 22.3165 3.2915 19.2505C4.28761 18.2285 5.54586 18.1761 6.27983 17.4948ZM62.4554 17.7044C52.7564 2.68913 30.2914 0.0162791 16.5293 11.1009C14.6944 12.5945 11.706 15.5294 10.8672 17.7044H62.4554ZM6.90895 20.9538C3.16042 23.2336 6.04392 28.7366 8.08857 31.4619C12.9905 37.9607 20.9594 39.664 27.8011 34.9471C30.5797 33.008 32.0215 29.7586 36.3467 29.7586C41.0389 29.7586 41.9302 32.877 44.8661 34.9471C51.4719 39.5592 58.9165 38.1179 64.0282 32.1694C66.3612 29.4441 69.3757 24.6749 66.5971 21.3993L6.90895 20.9538ZM67.4884 32.7984C63.4515 40.6074 53.2806 42.9658 45.469 39.4019C42.2447 37.9345 39.2302 33.4011 36.3467 33.4011C33.4632 33.4011 30.6584 37.7248 27.6438 39.2185C19.7536 43.0968 9.34682 40.686 5.17887 32.8245C3.57985 33.5059 3.84198 36.7028 3.94683 38.1441C4.70702 51.063 13.908 63.4317 26.3069 67.3624C49.0865 74.6211 70.765 56.566 68.7466 33.1128L67.4884 32.7984Z" fill="black"/>
		<path d="M54.0145 47.3158C58.0776 46.0318 55.2203 51.6658 53.6475 53.2643C52.2844 54.6532 44.1582 60.2348 42.5854 57.9812C40.8815 55.5179 47.9067 53.4216 49.7941 51.9279C50.9475 51.0107 53.6999 47.4207 54.0145 47.3158Z" fill="black"/>
		</svg>`,

	// SVG 4
		`<svg width="81" height="74" viewBox="0 0 81 74" fill="none" xmlns="http://www.w3.org/2000/svg">
		<path d="M2.91363 0.759392C6.47867 -0.419819 8.94272 5.68589 11.2757 7.91329C12.6913 9.27593 14.3165 10.4289 16.099 11.2151C17.3835 11.3461 22.6 6.89131 24.4611 5.97414C37.8038 -0.629443 53.7678 1.99102 65.0659 11.3461C66.56 11.3461 70.5445 7.25816 71.6979 6.00033C73.6377 3.93016 74.4503 0.23531 77.6221 0.628381C79.5357 0.890428 80.191 3.11782 80.427 4.79492C81.4231 11.8702 79.326 19.784 74.3192 24.9463C90.8075 89.4885 -9.69507 89.4099 7.29128 24.8415C3.07091 20.937 0.65926 14.8837 0.528192 9.14491C0.501979 7.33679 1.07868 1.33591 2.88741 0.733202L2.91363 0.759392ZM13.8184 13.888C9.49321 12.5515 7.78934 8.20155 4.38158 5.7121C4.04081 11.1103 4.46022 16.7967 8.47088 20.806L13.8184 13.9142V13.888ZM36.965 5.86932C-7.04751 10.822 3.43789 79.7404 48.4465 69.5467C86.7444 60.873 77.4648 1.2835 36.965 5.86932ZM76.4163 5.7121L67.9493 14.2548L72.6416 20.7798C74.0571 21.1467 76.1279 15.6961 76.4425 14.5169C76.7571 13.3377 78.2512 5.60728 76.4163 5.68589V5.7121Z" fill="black"/>
		<path d="M49.6785 55.9988L46.8212 55.3961C45.7989 46.932 43.2037 43.735 34.3436 44.757C32.1679 44.9929 25.3261 48.2947 24.5397 47.1941C23.9368 44.2329 25.9552 43.9185 28.131 42.9751C39.927 37.9176 50.6484 42.1628 49.6785 56.025V55.9988Z" fill="black"/>
		<path d="M24.9851 17.7924C26.0599 18.9454 26.0861 20.7535 28.3404 22.3258C30.5948 23.8981 32.8492 23.7409 34.9463 25.2083L34.4744 27.6454C28.8909 28.3005 22.3375 23.8195 21.9443 18.0807C22.1278 17.1897 24.3298 17.1373 24.9851 17.8186V17.7924Z" fill="black"/>
		<path d="M56.9917 17.7137C58.1976 17.3207 59.718 17.7137 59.7442 19.1812C59.7966 22.7451 50.4646 29.7417 46.8209 27.095C45.7724 23.2953 50.7791 24.2649 53.4267 22.2996C55.1044 21.0679 56.1005 18.002 57.018 17.6875L56.9917 17.7137Z" fill="black"/>
		<path d="M57.6996 29.1128C60.7666 32.1787 56.1792 38.3892 52.221 34.904C48.2627 31.4188 54.3443 25.7324 57.6996 29.1128Z" fill="black"/>
		<path d="M26.2433 28.4316C31.119 27.5668 32.4821 34.5635 28.4715 35.7427C22.8093 37.4198 21.1055 29.3488 26.2433 28.4316Z" fill="black"/>
		</svg>`,

	// SVG 5
		`<svg width="81" height="75" viewBox="0 0 81 75" fill="none" xmlns="http://www.w3.org/2000/svg">
		<path d="M70.0479 8.02254C72.1974 5.97857 76.1032 -2.72138 79.3537 1.99547C82.6041 6.71232 79.3012 21.3083 74.1634 25.0032C84.0983 51.4699 61.5547 78.6704 33.7422 73.3771C15.6811 69.9443 3.41313 53.2519 4.85488 34.9872C5.01216 32.8646 7.34516 25.5011 7.2403 25.0032C7.13545 24.5053 3.85876 21.3083 3.07236 19.7623C1.2112 16.1198 -1.48879 2.12647 3.41313 0.790035C6.32283 0.00389379 9.62573 6.79092 12.0636 8.8873C17.6471 13.6828 16.9917 10.381 21.6315 7.73429C36.0752 -0.59881 52.013 1.07829 64.91 11.3767C66.011 11.4029 69.1566 8.86109 70.0479 8.02254ZM13.6364 13.9186C9.38981 12.5035 7.4238 8.3894 4.19954 5.74272C3.85876 11.1409 4.27818 16.8273 8.28884 20.8366L13.6364 13.9448V13.9186ZM37.412 5.92617C-4.55578 10.1975 0.791777 74.3728 44.1489 70.5208C85.5925 66.8259 80.0614 1.6024 37.412 5.92617ZM77.1779 5.74272L67.7411 14.2593L72.4595 20.8366C75.2381 21.5442 78.0692 7.99633 77.1779 5.74272Z" fill="black"/>
		<path d="M26.6123 46.0455C29.9939 44.9187 29.1288 48.797 29.8628 50.8672C32.8774 59.4099 46.6657 60.0913 50.7025 51.8892C51.3579 50.5527 52.6423 43.3203 54.8705 46.5958C56.4171 48.8494 53.8744 54.0904 52.3016 56.0033C46.1676 63.3406 33.1657 62.6331 27.8444 54.7455C26.7434 53.1208 24.1745 46.8579 26.6123 46.0455Z" fill="black"/>
		<path d="M55.8399 27.6761C56.5739 28.6719 58.9855 28.3836 58.7496 32.393C58.2777 40.333 48.5263 36.8478 51.4098 30.2704L48.0283 30.3228C46.1933 25.9728 53.6642 26.5755 54.87 22.7496C57.57 23.7978 55.604 27.3354 55.8661 27.6761H55.8399Z" fill="black"/>
		<path d="M30.6228 30.2703C30.8849 33.4149 30.6227 37.1098 26.6645 37.0836C23.8072 36.1402 22.5228 33.6246 23.1781 30.7158C23.5189 29.1435 24.882 28.5933 25.249 27.7285C25.8781 26.1824 25.0655 24.4005 26.5334 23.3523L34.3451 28.7767C33.8994 30.9779 32.4053 30.9779 30.6228 30.2703Z" fill="black"/>
		</svg>`,

	// SVG 6
		`<svg width="73" height="80" viewBox="0 0 73 80" fill="none" xmlns="http://www.w3.org/2000/svg">
		<path d="M47.0698 71.1316C48.3018 78.1021 40.7523 82.5045 36.0077 76.7132C35.4834 76.0581 35.1688 74.4596 34.9591 74.3286C34.3562 73.9617 31.997 74.4072 30.6077 73.9617C29.4281 73.5949 22.4815 70.162 20.7776 69.3235C-24.231 46.6564 14.932 -21.1351 57.2668 7.69003C81.6978 24.33 75.459 63.3488 47.0436 71.1578L47.0698 71.1316ZM47.0173 67.3057C78.526 57.8982 75.092 10.8608 42.7707 5.20059C9.55824 -0.616855 -9.76111 41.2583 16.8194 62.5889C17.7106 63.2964 26.8854 69.5331 26.8854 66.3624V49.3817C25.5747 47.888 22.6126 48.9625 23.1106 46.2372L24.0543 45.2938H50.4775L51.4212 46.2372L50.8183 48.1239L47.0173 48.4121V67.2795V67.3057ZM43.8717 73.2804V49.3817L42.928 48.4383H30.031V68.878C30.031 70.5027 32.5213 71.4723 34.0679 70.3979C35.431 69.4283 34.9591 67.7512 38.2358 68.5636C38.2882 70.4503 37.9999 72.4157 38.4979 74.2762C39.3368 77.3159 43.295 75.9795 43.8717 73.2804Z" fill="black"/>
		<path d="M47.0179 29.5448C48.381 30.1213 53.7286 33.1087 54.2529 33.9472C55.3014 35.6767 54.3315 37.6945 52.0771 36.7773C50.583 36.1746 41.4082 29.8069 41.5131 28.6014C44.1082 26.0072 48.5645 22.4433 51.8412 20.8449C52.7063 20.4256 53.5713 19.6656 54.5936 20.3994C58.447 22.8102 45.681 27.5532 47.0441 29.5186L47.0179 29.5448Z" fill="black"/>
		<path d="M31.1585 30.095C30.8439 30.619 21.7216 36.3579 21.0139 36.6461C20.3585 36.9082 20.1488 37.2226 19.3362 36.8296C14.8537 34.6022 25.2867 30.3832 26.2303 28.6275C26.2303 27.9986 18.4449 23.6486 18.1828 23.1769C17.3964 21.8405 18.2352 19.9275 20.1226 20.2158C20.9614 20.3468 30.8964 27.3697 31.1585 28.1296C31.3682 28.7061 31.473 29.5709 31.1585 30.095Z" fill="black"/>
		</svg>`,

	// SVG 7
		`<svg width="80" height="73" viewBox="0 0 80 73" fill="none" xmlns="http://www.w3.org/2000/svg">
		<path d="M77.2731 44.1023C73.4459 48.6882 73.0265 51.7279 69.8285 56.471C54.5722 79.007 21.2286 76.5176 8.38401 52.7237C7.30926 50.7321 6.47042 47.0373 5.42188 45.6222C3.95393 43.6569 0.782089 42.9755 0.729662 38.9924C0.677235 35.0093 3.77043 34.1183 4.5044 32.4936C5.91993 29.3491 6.12964 24.1606 8.20051 19.994C21.0451 -5.87003 59.0023 -5.97486 72.1877 19.7582C74.3634 24.0033 74.4682 29.2443 75.9624 32.3364C76.5653 33.568 78.5575 34.3804 79.108 36.1099C80.0517 39.1496 79.2391 41.7701 77.2993 44.1023H77.2731ZM63.6421 38.0228C63.6421 30.0566 60.3916 28.5105 71.8207 30.4759C65.1887 -4.66461 15.9597 -4.63842 8.27915 30.1614C14.0723 30.3711 17.8471 27.1217 17.0345 35.1403C16.5626 39.6213 14.2558 44.7575 9.5374 45.9105C12.4471 56.471 21.8053 65.1447 32.448 67.6604C49.2246 71.6435 65.2149 62.3932 71.1391 46.487C69.5925 45.1243 67.9149 44.7312 66.4731 43.0541C65.1625 41.5343 64.5071 38.4945 63.6683 37.9966C63.6683 46.3821 57.1411 56.1303 49.4081 59.2749C33.2606 65.8784 17.9781 54.3746 17.3752 37.9442C17.8209 37.3153 18.6073 37.4201 19.2888 37.3153C29.0927 36.1099 50.5877 36.6602 60.8897 37.3153C61.9382 37.3939 62.7508 37.4201 63.6683 37.9704L63.6421 38.0228ZM13.9413 32.9915C9.56362 32.2316 0.519955 36.3719 5.13353 41.4819C9.98303 46.88 14.6752 37.4463 13.9413 32.9915ZM66.1586 32.9915C65.2149 37.6298 71.7421 47.3517 75.6217 40.9054C78.8197 35.5858 70.1954 32.4937 66.1586 32.9915ZM59.8673 41.1674H20.8616C26.4189 63.2318 54.3101 63.1794 59.8673 41.1674Z" fill="black"/>
		<path d="M45.4239 29.8208C44.8472 17.8715 60.8636 16.9019 63.6423 28.301L62.6199 29.7946C59.4743 30.607 59.8675 26.9121 57.9277 25.1826C53.6811 21.4353 49.0938 24.8681 47.9404 29.5588L45.4239 29.8208Z" fill="black"/>
		<path d="M32.2384 29.7945C31.7404 29.4539 31.1113 24.0033 26.786 23.5578C21.1501 22.9813 21.6482 30.3448 17.087 29.8469C16.4841 19.6533 31.452 16.4825 34.8336 26.2569C35.7773 28.956 34.2569 31.2358 32.2122 29.7945H32.2384Z" fill="black"/>
		</svg>`,

	
	// SVG 8
		`<svg width="81" height="72" viewBox="0 0 81 72" fill="none" xmlns="http://www.w3.org/2000/svg">
		<path d="M72.486 39.5736C79.4064 38.473 83.2336 45.6793 79.4064 51.2085C78.7773 52.1257 71.0443 59.9085 70.3103 60.3539C66.9026 62.3717 66.2734 58.2052 64.7006 58.4672C64.0191 58.5982 60.69 62.5813 59.5628 63.4461C24.0959 91.0659 -18.1865 45.129 8.97073 12.871C31.8289 -14.3033 75.186 4.90479 72.486 39.5736ZM68.7113 40.8314V31.0833C68.7113 25.8423 62.2628 15.4915 58.3045 11.9276C35.0794 -9.00991 -1.61953 12.0063 4.82899 42.7444C10.5173 69.8925 45.4075 77.2298 62.3938 55.6109C52.1968 48.7191 55.8405 35.6953 68.6851 40.8314H68.7113ZM62.8919 42.7968C60.6638 43.2161 59.4055 45.8103 60.0084 47.9067C60.5065 49.61 67.0336 54.6413 68.4754 56.5018C69.1569 56.6329 75.2122 50.632 75.9462 49.6362C80.6122 43.4519 72.853 40.0715 68.921 45.8103C67.7152 46.02 65.7492 42.2465 62.8657 42.7968H62.8919Z" fill="black"/>
		<path d="M38.5392 45.8369C36.8616 43.5833 45.3548 35.7219 49.5227 42.1158C52.4062 46.5444 48.7625 48.7456 48.7887 49.951C48.7887 50.9992 51.8557 52.7549 50.0208 57.0263C46.8751 64.3636 34.7645 55.585 40.1383 54.0389C41.9732 53.5149 45.0402 59.2275 47.0586 55.2968C48.3169 52.8597 44.1227 51.8115 44.28 50.0558C44.6208 48.3525 47.9237 46.3348 47.0586 44.6052C44.8043 40.098 40.5839 48.5884 38.5392 45.8369Z" fill="black"/>
		<path d="M41.6846 29.4852C40.5574 22.3576 49.103 17.3787 55.1845 21.3356C56.7573 22.3576 62 28.4632 58.8806 29.459C55.735 30.2714 56.1282 26.5765 54.1884 24.847C52.1175 23.0127 49.2078 22.7506 46.9797 24.4801C44.7515 26.2096 45.3544 30.4548 41.6583 29.5114L41.6846 29.4852Z" fill="black"/>
		<path d="M16.3623 26.2096C15.838 26.891 13.5312 26.8386 13.3215 25.9476C12.9021 19.4226 18.4856 13.3169 25.0914 13.1859C27.1098 13.1335 28.971 15.5181 27.2147 16.6449C25.2224 17.9552 21.5263 15.8064 18.3807 20.3922C16.9914 22.4362 17.0438 25.3449 16.3623 26.2359V26.2096Z" fill="black"/>
		<path d="M23.8863 21.4403C30.5707 19.5273 30.8853 31.1622 23.3882 28.5942C19.928 27.4149 21.1338 22.2264 23.8863 21.4403Z" fill="black"/>
		</svg>`,

	
	// SVG 9
		`<svg width="72" height="77" viewBox="0 0 72 77" fill="none" xmlns="http://www.w3.org/2000/svg">
		<path d="M12.7196 0.92039C15.1313 0.291477 18.539 6.89509 20.2167 8.36256C41.6593 -2.01451 67.3224 11.2189 71.3592 34.5934C76.8116 66.3798 40.5846 88.4965 14.5021 69.4195C0.975976 59.5141 -2.95605 41.9308 2.99442 26.4962C3.59733 24.9239 5.53713 22.5131 5.72062 21.6745C5.90412 20.836 4.22645 17.8749 4.17403 16.224C3.99053 11.0354 8.76139 4.11739 12.7196 0.94662V0.92039ZM13.2177 4.64149C8.23712 8.15292 3.38762 22.1462 13.2177 22.1462C23.0478 22.1462 18.3293 8.25774 13.2177 4.64149ZM7.94877 24.164C-3.00848 43.6079 7.8177 68.0831 29.7846 72.3544C58.4622 77.936 79.2757 45.5732 62.2632 21.6483C53.4292 9.22729 35.7875 4.51046 22.0254 11.5071C20.9245 13.1318 23.6507 19.0803 19.3779 22.8538C15.8128 25.9721 12.0643 25.1073 7.97499 24.1378L7.94877 24.164Z" fill="black"/>
		<path d="M52.9574 47.5909C58.0953 52.8843 53.9535 60.667 47.0332 61.689C42.6293 62.3441 28.9983 62.4227 24.6993 61.689C14.5284 59.9857 15.0265 46.5165 24.0702 44.9966C28.474 44.2629 41.9478 44.3415 46.5613 44.8394C48.4487 45.049 51.6468 46.2282 52.9574 47.5647V47.5909ZM28.0022 48.6391C17.91 47.2502 17.91 59.4616 28.0022 58.0728V48.6391ZM42.472 48.6391H29.8896V58.0728H42.472V48.6391ZM44.3594 58.0728C53.6652 59.4092 54.2157 47.1192 44.3594 48.6391V58.0728Z" fill="black"/>
		<path d="M48.632 26.1292C52.9572 25.5527 57.8854 28.9331 59.065 33.0735C59.4582 34.4885 58.829 36.2967 57.3349 36.0346C55.5261 35.7201 55.0805 29.169 49.0776 29.7193C45.0145 30.0861 44.2543 36.978 41.8427 35.7725C38.0155 33.8334 44.7262 26.6533 48.632 26.103V26.1292Z" fill="black"/>
		<path d="M28.4212 28.7235C29.4173 29.7193 32.7464 35.3009 30.1775 36.0608C26.9795 37.0042 28.0018 30.1124 22.628 29.7455C16.3106 29.3 16.9397 35.4319 15.0261 36.0084C11.3562 37.1352 13.2436 31.4226 14.8688 29.5621C18.3815 25.5528 24.5154 24.8714 28.395 28.7235H28.4212Z" fill="black"/>
		</svg>`,

	
	// SVG 10
		`<svg width="72" height="72" viewBox="0 0 72 72" fill="none" xmlns="http://www.w3.org/2000/svg">
		<path d="M32.3799 0.352513C80.4292 -4.41674 85.9865 68.2751 39.1168 71.8651C-7.75297 75.4552 -13.5724 4.91213 32.3799 0.352513ZM30.4663 4.126C18.1197 5.8031 7.08386 17.1235 4.48872 29.0991C-1.48795 56.745 28.7624 78.3901 52.9575 63.7155C82.5525 45.7915 66.9293 -0.826692 30.4663 4.126Z" fill="black"/>
		<path d="M49.3137 24.8276C54.7924 23.7008 56.2603 30.6188 52.0137 31.9815C46.0108 33.9468 44.6739 25.771 49.3137 24.8276Z" fill="black"/>
		<path d="M21.003 24.8277C27.7923 22.81 27.7923 34.1304 21.003 32.1126C17.805 31.1693 17.805 25.7711 21.003 24.8277Z" fill="black"/>
		</svg>`,

	
	// SVG 11
		`<svg width="72" height="73" viewBox="0 0 72 73" fill="none" xmlns="http://www.w3.org/2000/svg">
		<path d="M32.3273 0.671456C80.665 -4.124 85.8291 68.7775 39.0642 72.1841C-7.70069 75.5907 -13.3628 5.20487 32.3273 0.671456ZM30.4137 4.41875C19.9808 5.8338 9.65265 14.9006 5.90412 24.5702C-5.07934 53.0809 26.0361 79.5476 52.5117 64.2441C82.5524 46.8966 67.401 -0.612539 30.3875 4.39256L30.4137 4.41875Z" fill="black"/>
		<path d="M20.3483 15.7392C21.4231 16.866 21.7638 19.2245 23.9658 20.6395C26.1677 22.0546 28.8415 21.5567 30.5716 23.4697C29.7852 26.5356 27.19 25.6184 24.9095 25.0419C26.6396 27.4527 26.7968 30.9904 24.3328 32.9296C19.6668 36.6244 17.0192 28.894 19.1949 25.435C19.8765 24.3606 22.3143 24.8585 21.7638 23.4434C21.0299 21.6091 16.4687 19.6438 17.3338 15.9751C17.858 15.0317 19.693 15.0317 20.3745 15.713L20.3483 15.7392Z" fill="black"/>
		<path d="M50.0739 23.7578C57.4662 24.5963 52.9836 37.358 47.8458 32.5887C45.5652 30.4662 45.9322 27.4264 47.5312 25.0418L42.9177 25.5921L41.8429 23.4433C41.8167 21.7662 45.7487 21.9758 47.5312 20.9014C49.1565 19.9319 54.0584 11.7822 55.0021 16.6039C55.4477 18.8313 49.7856 23.3385 50.0739 23.7315V23.7578Z" fill="black"/>
		<path d="M40.7682 47.1587C38.8021 49.1503 34.1361 57.8502 31.908 53.5002C31.4886 51.9017 38.3827 45.0623 39.8245 43.359C41.0827 42.966 54.9497 45.1147 55.9982 45.8223C56.5749 46.2153 57.0467 46.5298 57.0205 47.3159L55.9458 48.8096L40.7682 47.1587Z" fill="black"/>
		</svg>`,

	
	// SVG 12
		`<svg width="71" height="73" viewBox="0 0 71 73" fill="none" xmlns="http://www.w3.org/2000/svg">
		<path d="M32.517 0.619128C80.3042 -3.20676 84.7605 68.2273 39.2277 72.1056C-8.79545 76.2197 -14.1168 4.3402 32.517 0.619128ZM29.9743 4.36638C-3.99838 8.9522 -6.12167 61.6499 29.3452 68.201C78.2072 77.2417 81.4576 -2.57787 29.9743 4.36638Z" fill="black"/>
		<path d="M33.7751 38.9566C37.6285 38.616 42.4256 39.7166 45.8071 41.682C47.9567 42.9136 55.0343 48.7048 53.1207 51.4039C51.2071 54.103 48.612 48.1021 47.4324 46.9753C41.0887 40.9482 30.5247 41.1055 24.1286 46.9753C22.8179 48.1545 20.4325 52.5569 18.8072 51.7445C16.0548 50.3819 20.0131 46.0319 21.2975 44.7741C24.2596 41.8916 29.6334 39.3759 33.7751 38.9829V38.9566Z" fill="black"/>
		<path d="M21.1664 21.8974C26.0159 21.1899 26.6975 32.982 21.6645 33.113C16.6315 33.2441 16.0548 22.6312 21.1664 21.8974Z" fill="black"/>
		<path d="M48.1923 21.9236C54.0903 20.1417 55.1127 31.8028 49.9224 32.5365C44.2865 33.3489 44.6011 22.998 48.1923 21.9236Z" fill="black"/>
		<path d="M44.9421 12.3851C46.0169 12.0706 50.0276 15.6606 51.5217 16.473C53.1994 17.3901 59.3596 18.9887 59.045 20.7968C57.6033 23.6793 52.7013 21.1636 50.4732 20.0368C49.0577 19.3293 40.381 13.6953 44.9421 12.3851Z" fill="black"/>
		<path d="M25.518 12.4899C26.9597 12.0969 27.9034 13.0926 27.5102 14.4815C26.6976 17.364 17.418 22.2643 14.587 22.3167C13.0928 22.3429 11.5986 20.0893 13.1452 18.9887C15.6617 18.4646 17.785 17.6784 20.0656 16.473C21.5598 15.6869 25.0199 12.5947 25.518 12.4637V12.4899Z" fill="black"/>
		</svg>`,

	
	// SVG 13
		`<svg width="72" height="72" viewBox="0 0 72 72" fill="none" xmlns="http://www.w3.org/2000/svg">
		<path d="M31.8868 0.326199C79.7002 -4.62649 85.4934 67.8557 39.2528 71.8388C-6.98783 75.8219 -14.249 5.12166 31.8868 0.326199ZM29.9732 4.07345C19.6189 5.4623 9.1859 14.634 5.46358 24.2249C-5.49366 52.7094 25.4383 79.281 52.0712 63.8988C82.1643 46.5251 66.8556 -0.931632 29.947 4.04726L29.9732 4.07345Z" fill="black"/>
		<path d="M16.6831 19.8486C18.7015 19.7438 20.5889 21.4471 21.5326 21.3947C22.4763 21.3423 24.0491 19.9272 25.4908 19.8224C30.9695 19.4555 34.351 25.4826 31.3889 30.016C30.786 30.9332 22.7384 38.8732 22.1355 39.0304C21.0083 39.3449 20.6151 39.0566 19.7239 38.5325C17.9676 37.4843 11.2045 29.9898 10.7851 27.972C9.97244 23.9889 12.5152 20.0844 16.7093 19.8224L16.6831 19.8486ZM16.1064 23.4911C9.86758 25.273 19.0423 32.951 21.087 34.6805C23.4462 33.3964 32.8568 25.1943 27.1685 23.5172C23.8656 22.5477 23.3413 25.9543 21.6374 25.9543C20.1957 25.9543 18.8326 22.7311 16.1064 23.4911Z" fill="black"/>
		<path d="M45.6486 19.8487C47.4835 19.8225 48.9777 21.3424 50.0524 21.3948C51.3107 21.4734 52.8311 19.4032 55.767 20.0321C61.2718 21.2376 62.2679 26.5047 59.332 30.9071C58.7029 31.8505 51.6515 38.8733 51.0485 39.0305C49.9214 39.345 49.5282 39.0567 48.6369 38.5326C47.9816 38.1396 41.035 31.1691 40.4583 30.3568C37.1554 25.6662 40.0389 19.9273 45.6223 19.8487H45.6486ZM44.4165 23.5174C38.6496 25.2207 47.5097 33.5014 50.0262 34.6806C52.4641 32.7152 59.4893 27.9984 56.8417 24.6966C53.9058 21.0541 51.6515 25.9544 49.9476 25.9544C48.2437 25.9544 47.7194 22.5478 44.4165 23.5174Z" fill="black"/>
		<path d="M25.5169 46.8132C26.7227 46.4463 45.0198 46.4202 46.0683 46.7608L47.012 47.7042C48.7945 59.8631 31.5722 64.6848 25.5693 54.6746C24.3897 52.7093 22.3451 47.7566 25.5169 46.8132ZM43.3421 50.4557H27.614C29.6586 58.6315 41.7693 58.9722 43.3421 50.4557Z" fill="black"/>
		</svg>`,

	
	// SVG 14
		`<svg width="71" height="73" viewBox="0 0 71 73" fill="none" xmlns="http://www.w3.org/2000/svg">
		<path d="M32.5419 0.912016C79.9884 -3.22833 85.0476 68.4939 39.2526 72.3984C-8.50844 76.4864 -14.354 4.97375 32.5419 0.912016ZM29.9992 4.65927C-3.97351 9.24509 -6.09679 61.9428 29.3701 68.4939C78.2845 77.5346 81.4563 -2.28498 29.9992 4.65927Z" fill="black"/>
		<path d="M44.6264 46.0102C45.2293 53.1379 45.2031 65.821 34.9536 64.8514C25.4906 63.9605 27.1945 53.3214 26.7488 46.613C25.7265 45.1979 13.7993 45.6696 16.4731 41.1361C17.5741 40.0618 23.9702 42.4726 26.1459 42.8132C35.6876 44.2807 45.1769 43.3636 54.3779 40.6121C60.7215 45.4075 45.2556 45.4075 44.6002 46.0365L44.6264 46.0102ZM30.7857 46.6392V58.274C30.7857 58.4575 32.9876 60.6325 33.3022 60.7635C35.7401 61.8903 40.8517 60.187 40.8517 57.6451V46.6392H37.0769L36.4478 55.4439C33.774 54.1337 36.1332 48.9452 34.9274 47.2418L30.7857 46.6653V46.6392Z" fill="black"/>
		<path d="M52.6475 24.1293C56.4747 27.9552 49.3446 33.9037 46.4873 29.1868C43.8922 24.9417 49.8426 21.2992 52.6475 24.1293Z" fill="black"/>
		<path d="M20.5355 23.4742C25.5423 22.0592 27.7705 29.1344 23.2617 30.6281C17.6783 32.4886 16.4724 24.6272 20.5355 23.4742Z" fill="black"/>
		</svg>`,

	
	// SVG 15
		`<svg width="72" height="72" viewBox="0 0 72 72" fill="none" xmlns="http://www.w3.org/2000/svg">
		<path d="M32.5171 0.326293C79.6228 -4.1023 85.4159 67.882 39.254 71.8389C-8.34976 75.9006 -14.4837 4.75489 32.5171 0.326293ZM30.6297 4.09974C-7.69442 8.68556 -4.3391 69.166 36.0821 68.7205C79.8325 68.2489 77.8665 -1.56048 30.6297 4.09974Z" fill="black"/>
		<path d="M31.8619 34.8902C43.8677 33.0035 54.4579 41.52 54.4055 53.6528L17.5231 53.9673C14.9542 52.1592 20.1969 43.0137 21.7173 41.1008C24.0503 38.1396 28.1396 35.493 31.8881 34.9165L31.8619 34.8902ZM20.695 51.0848H49.9492L50.657 49.7745C45.6502 33.4228 24.2862 34.4186 20.695 51.0848Z" fill="black"/>
		<path d="M49.4514 19.1151C54.6417 18.3289 55.0611 29.3087 49.9495 30.3307C44.7854 29.7018 44.4709 19.875 49.4514 19.1151Z" fill="black"/>
		<path d="M19.6204 29.5182C16.7107 27.1598 17.5495 17.962 23.3951 19.7701C28.1398 21.2375 25.099 33.9992 19.6204 29.5182Z" fill="black"/>
		</svg>`,

	
	// SVG 16
		`<svg width="72" height="73" viewBox="0 0 72 73" fill="none" xmlns="http://www.w3.org/2000/svg">
		<path d="M33.2235 0.790576C79.7525 -2.72085 84.8641 68.1367 39.9604 72.277C-9.05887 76.8104 -14.2491 4.35442 33.2235 0.790576ZM30.6808 4.53785C-8.06275 9.49054 -4.10453 70.4951 36.7885 69.1587C80.6175 67.7174 76.7904 -1.332 30.6808 4.53785Z" fill="black"/>
		<path d="M35.5301 38.6564C47.8242 38.3944 47.8767 59.9608 38.0204 61.5593C22.8952 64.0226 22.9214 38.9447 35.5301 38.6564ZM34.4292 42.2203C28.5835 43.3995 28.3214 56.3708 33.9311 58.1789C43.7874 61.3235 44.3116 40.2025 34.4292 42.2203Z" fill="black"/>
		<path d="M49.5283 19.5532C54.6138 18.8195 54.9546 30.6378 50.0264 30.7688C45.0983 30.8998 44.4167 20.2869 49.5283 19.5532Z" fill="black"/>
		<path d="M24.3632 20.8894C27.404 23.7457 25.5166 32.1836 20.5623 30.69C15.6079 29.1963 18.8322 15.7009 24.3632 20.8894Z" fill="black"/>
		</svg>`,

	
	// SVG 17
		`<svg width="71" height="73" viewBox="0 0 71 73" fill="none" xmlns="http://www.w3.org/2000/svg">
		<path d="M33.1448 0.471362C80.0145 -3.04007 84.6019 67.8174 39.8816 71.9578C-8.95412 76.4912 -14.2755 4.009 33.1448 0.471362ZM30.6021 4.21864C-8.06284 9.14512 -4.0784 70.2021 36.7098 68.8394C80.6174 67.372 76.7378 -1.67742 30.6021 4.21864Z" fill="black"/>
		<path d="M17.9151 38.6778C18.5704 38.4944 28.4267 41.5604 31.0743 41.7962C36.7364 42.2679 42.3461 41.5341 47.8509 40.3549C52.9101 39.2805 56.7111 35.9787 53.6703 44.9145C48.9257 58.8816 30.8908 63.7033 21.6636 51.8064C20.3005 50.0507 14.2976 39.7522 17.8889 38.6778H17.9151ZM21.3229 43.6829C24.5471 56.0515 40.5374 59.2747 48.0082 48.6618C48.716 47.666 50.0529 45.1504 50.2626 43.9974C50.5247 42.6347 50.3674 43.1588 49.6334 43.3423C39.8558 45.9889 31.2054 45.8841 21.3229 43.6829Z" fill="black"/>
		<path d="M24.311 29.6896C18.8061 34.8519 15.477 21.4613 20.51 19.9152C26.041 18.2119 27.0896 27.0953 24.311 29.6896Z" fill="black"/>
		<path d="M51.9663 19.9938C55.5837 23.0073 52.7789 33.8036 47.7721 29.5061C43.211 25.6016 47.7197 16.4561 51.9663 19.9938Z" fill="black"/>
		</svg>`,

	
	// SVG 18
		`<svg width="72" height="72" viewBox="0 0 72 72" fill="none" xmlns="http://www.w3.org/2000/svg">
		<path d="M33.717 0.217553C80.377 -2.90081 85.1217 67.5636 40.4539 71.704C-9.03723 76.2898 -13.3362 3.36212 33.717 0.217553ZM31.1743 3.96483C-7.77898 8.94372 -3.71589 70.5772 37.9111 68.5594C79.5382 66.5416 76.9693 -1.90503 31.1743 3.96483Z" fill="black"/>
		<path d="M43.049 57.6583C33.9004 66.2797 22.9956 51.8671 29.5228 41.3066C33.481 34.9388 41.3713 35.6726 44.8577 42.1189C47.3218 46.6785 46.9023 54.0159 43.0227 57.6583H43.049ZM36.181 40.3632C29.2869 41.621 29.2606 57.0032 37.282 56.6625C45.7752 56.3219 44.0975 38.922 36.181 40.3632Z" fill="black"/>
		<path d="M50.2052 26.4224C53.0363 26.37 54.2159 27.6802 54.0324 30.5103C53.6654 36.1443 43.5732 33.7073 47.0596 27.6802C46.4567 27.2347 40.5586 29.6718 42.1052 25.5576C42.4722 24.5881 46.5353 24.1426 48.2916 22.911C50.3887 21.4435 51.6994 17.1721 53.5605 17.67C58.4363 18.9803 49.812 26.0293 50.2052 26.3962V26.4224Z" fill="black"/>
		<path d="M25.6697 27.7064C28.1862 39.9702 11.1474 31.4275 22.5241 26.1341C20.4532 25.5838 15.2367 18.6134 18.4348 17.6438C20.3746 17.0411 21.7377 21.6007 23.8085 22.9634C26.3775 24.6405 33.324 24.4832 29.025 28.2829L25.6697 27.7064Z" fill="black"/>
		</svg>`,

	
	// SVG 19
		`<svg width="72" height="72" viewBox="0 0 72 72" fill="none" xmlns="http://www.w3.org/2000/svg">
		<path d="M33.6906 0.10956C80.5866 -3.035 85.2264 67.9011 39.7984 71.596C-9.03736 75.5791 -13.2577 3.25413 33.6906 0.10956ZM31.1479 3.85683C-7.62183 8.80952 -3.68981 69.8403 37.2557 68.4776C80.9274 67.0102 77.2837 -2.03923 31.1479 3.85683Z" fill="black"/>
		<path d="M45.1459 45.8367V58.7294C45.1459 61.612 39.5362 65.333 36.6527 65.333C34.1362 65.333 28.1595 61.9264 28.1595 59.3584V46.7801C26.1935 44.3693 19.0896 50.6846 18.6702 46.7801C18.3819 44.0024 26.3508 42.6136 28.6314 42.2467C33.7954 41.4081 39.4837 41.4343 44.6478 42.2467C46.5352 42.5349 56.2342 44.3431 55.7885 46.7277L54.1633 48.2476L45.1196 45.8629L45.1459 45.8367ZM35.709 45.2078C34.3459 45.2864 31.9081 44.6575 31.3838 46.2298C31.6197 51.1563 29.1556 61.612 36.6527 61.612C44.1498 61.612 41.6857 51.1563 41.9216 46.2298C41.3973 44.6575 38.9595 45.2864 37.5964 45.2078V54.956L36.6527 55.8993L35.709 54.956V45.2078Z" fill="black"/>
		<path d="M29.3659 33.1799C27.4523 35.8527 23.5203 29.485 22.8125 29.485C21.5281 30.2187 19.0902 34.4115 17.465 33.5991C13.8737 31.2407 20.2174 28.2796 19.929 26.7335C12.799 20.8112 17.7533 17.8501 22.8125 24.4275C23.4154 24.4275 28.5795 16.7757 29.3135 22.7504L25.6698 27.179C26.5873 28.5678 30.7028 31.3193 29.3397 33.1799H29.3659Z" fill="black"/>
		<path d="M55.1864 20.6802C57.2048 22.0952 52.5126 26.3142 51.4379 27.2576C53.0369 29.4063 58.4893 32.1054 53.7184 33.8087L49.2359 29.4588L43.6 33.8611C40.035 31.1359 46.667 28.3844 46.3786 26.7073C45.5922 25.2136 42.1583 23.4841 42.6563 21.5973C43.6 18.0073 48.0301 24.5585 49.1835 24.375C50.5466 23.4317 53.3514 19.3699 55.2388 20.654L55.1864 20.6802Z" fill="black"/>
		</svg>`,

	
	// SVG 20
		`<svg width="71" height="73" viewBox="0 0 71 73" fill="none" xmlns="http://www.w3.org/2000/svg">
		<path d="M32.5175 0.921549C79.4659 -3.42843 85.495 68.3725 39.2544 72.4342C-6.98626 76.4959 -14.5095 5.29773 32.5175 0.921549ZM30.6301 4.66882C19.437 6.00526 8.4535 15.57 4.94089 26.1567C-4.20763 53.8288 24.3127 78.5923 50.4737 65.3851C82.1397 49.4265 68.063 0.161618 30.6039 4.64262L30.6301 4.66882Z" fill="black"/>
		<path d="M56.0051 30.1921C54.7993 25.6587 50.1071 21.8328 45.8343 25.5277C43.6324 27.4144 44.6547 31.1093 40.8537 30.2707C39.6217 22.2521 49.976 17.4829 55.8741 23.1169C57.8925 25.056 61.5362 31.2141 56.0051 30.1921Z" fill="black"/>
		<path d="M27.6677 30.2185C27.222 29.904 26.4094 24.2962 22.2415 24.008C16.5007 23.6149 17.1036 30.6902 12.5162 30.2709C11.9133 20.0773 26.8812 16.9065 30.2628 26.6808C31.2065 29.3799 29.6861 31.6597 27.6414 30.2185H27.6677Z" fill="black"/>
		<path d="M57.761 42.9016C58.3115 49.1383 49.7921 57.4714 44.13 58.441C42.3212 58.7555 40.5649 57.9169 41.7445 56.0302C42.0591 55.5323 48.2455 52.6236 49.9756 51.0513C52.7542 48.4832 53.6979 45.3911 55.926 42.5085L57.7872 42.9016H57.761Z" fill="black"/>
		</svg>`,

	
	// SVG 21
		`<svg width="71" height="72" viewBox="0 0 71 72" fill="none" xmlns="http://www.w3.org/2000/svg">
		<path d="M33.7738 0.0571441C80.4863 -2.27507 84.0251 67.5343 39.8554 71.5436C-9.92406 76.1032 -13.725 2.44177 33.7738 0.0571441ZM31.2574 3.83062C-8.79688 8.44265 -3.79012 70.8098 37.3651 68.4252C80.6698 65.9096 76.2922 -1.33171 31.2574 3.83062Z" fill="black"/>
		<path d="M18.8584 37.661L21.3225 37.2417C24.4681 41.8013 28.0594 46.2561 33.1448 48.7456C35.006 49.6627 40.9826 50.5013 40.1962 53.0169C39.4098 55.5326 34.4555 52.3618 33.2759 52.9907C32.2798 53.5148 29.3701 58.3889 27.9545 59.6729C20.7196 66.2241 11.3352 58.3627 15.5293 50.3965C16.4992 48.5621 20.274 44.9197 20.5885 43.4522C21.008 41.4082 18.0458 39.967 18.8584 37.6872V37.661ZM22.5808 53.9603C22.4235 51.6805 24.4681 50.1868 25.6739 48.5359L23.5244 45.8106C11.6497 56.5022 22.6332 65.1759 30.104 51.1302L27.3516 49.6103C26.4079 49.8462 24.6778 54.3534 22.5808 53.9603Z" fill="black"/>
		<path d="M27.6658 29.3801C27.2201 29.0656 26.4075 23.4578 22.2396 23.1695C16.4988 22.7765 17.1017 29.8517 12.5143 29.4325C11.7804 18.8196 27.692 16.3563 30.4706 26.2617C31.1784 28.8036 29.3958 30.5855 27.6658 29.3539V29.3801Z" fill="black"/>
		<path d="M40.8511 29.4065C39.7239 22.2788 48.2695 17.2999 54.351 21.2568C55.9238 22.2788 61.1665 28.3845 58.0471 29.3803C54.9015 30.1926 55.2947 26.4978 53.3549 24.7683C50.9171 22.6195 47.8501 22.7767 45.5957 25.0827C43.8132 26.917 44.3637 30.2713 40.8511 29.4065Z" fill="black"/>
		</svg>`,

	



  ];

  // --- Choisir alÃ©atoirement un SVG
  const randomSVG = SHAPES[Math.floor(Math.random() * SHAPES.length)];

  // --- CrÃ©ation du canvas
  const canvas = document.createElement('canvas');
  canvas.className = 'confetti-canvas';
  Object.assign(canvas.style, {
    position: 'fixed',
    top: '0',
    left: '0',
    width: '100%',
    height: '100%',
    pointerEvents: 'none',
    zIndex: 3000,
  });
  document.body.appendChild(canvas);
  const ctx = canvas.getContext('2d');

  // --- Origine du tir
  const rect = originEl.getBoundingClientRect();
  const originX = rect.left + rect.width / 2;
  const originY = rect.top + rect.height / 2;

  // --- Image Ã  partir du SVG colorÃ©
  const colored = randomSVG.replace(/fill="black"/g, `fill="${color}"`);
  const blob = new Blob([colored], { type: 'image/svg+xml;charset=utf-8' });
  const url = URL.createObjectURL(blob);
  const img = new Image();
  img.src = url;

  // --- Particules
  const particles = [];
  const total = 20;
  for (let i = 0; i < total; i++) {
    particles.push({
      x: originX,
      y: originY,
      size: Math.random() * 45 + 35,
      vx: (Math.random() - 0.5) * 12,
      vy: (Math.random() - 0.5) * 12 - 5,
      rotation: Math.random() * 10,
      rotationSpeed: (Math.random() - 0.5) * 2,
      life: Math.random() * 100 + 80,
    });
  }

  // --- Animation
  let frame = 0;
  function animate() {
    ctx.clearRect(0, 0, canvas.width, canvas.height);
    if (!img.complete) {
      requestAnimationFrame(animate);
      return;
    }

    particles.forEach((p) => {
      p.x += p.vx;
      p.y += p.vy;
      p.vy += 0.2; // gravitÃ©
      p.rotation += p.rotationSpeed;
      p.life--;

      ctx.save();
      ctx.translate(p.x, p.y);
      ctx.rotate((p.rotation * Math.PI) / 180);
      ctx.drawImage(img, -p.size / 2, -p.size / 2, p.size, p.size);
      ctx.restore();
    });

    frame++;
    if (particles.some((p) => p.life > 0) && frame < 300) {
      requestAnimationFrame(animate);
    } else {
      canvas.remove();
      URL.revokeObjectURL(url);
    }
  }

  const resize = () => {
    canvas.width = window.innerWidth;
    canvas.height = window.innerHeight;
  };
  resize();
  window.addEventListener('resize', resize);
  animate();
}








	let scrollContainer = $state(null);

	import { register } from 'swiper/element/bundle';
	register();
	let swiperEl = $state(null);

	onMount(() => {
		if (swiperEl) {
			Object.assign(swiperEl, {
				slidesPerView: 1,
				speed: 500,
				loop: true,
				pagination: {
					clickable: true
				},
				navigation: true
			});
			// Appliquer les variables CSS
			swiperEl.style.setProperty('--swiper-navigation-color', currentPiece.color);
			swiperEl.style.setProperty('--swiper-navigation-size', '0');
			swiperEl.style.setProperty('--swiper-pagination-bullet-inactive-opacity', '1');
			swiperEl.style.setProperty('--swiper-pagination-bullet-inactive-color', 'white');
			swiperEl.style.setProperty('--swiper-pagination-color', 'black');
			swiperEl.style.setProperty('--swiper-pagination-bullet-size', '10px');

			swiperEl.initialize();
		}

	});



	// â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”
	// CONSTANTES
	// â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”
	// const LABELS = ["L'oeuvre", "D'aprÃ¨s toi...", 'La Couleur'];
	// const OFFSET = 90;
	// const SCROLL_MS = 800;

	let gsap;
	let gsapReady;
	let circleEl = $state(null);

	onMount(async () => {
		// Import scroll freeze utility and unfreeze scroll for indices page
		const { unfreezeScroll, freezeScroll } = await import('$lib/utils/scrollFreeze.js');
		unfreezeScroll();

		gsapReady = import('gsap').then((m) => (gsap = m.gsap ?? m.default ?? m));
		piecesStore.initialize();
		hasInitialized = true;

		// Return cleanup function to restore scroll freeze when leaving this page
		return () => {
			freezeScroll();
		};
	});

	async function expand() {
		if (!gsap) await gsapReady;
		if (circleEl) gsap.to(circleEl, { scale: 9, duration: 3, ease: 'power3.out' });
	}
	async function shrink() {
		if (!gsap) await gsapReady;
		if (circleEl) gsap.to(circleEl, { scale: 1, duration: 4, ease: 'elastic.out(1, 0.3)' });
	}

	let active = $state(0);
	let hasInitialized = $state(false);

	let pieceId = $derived(page.params.id);
	let currentPiece = $derived(PIECES_DATA[pieceId]);
	let totalPiece = $derived(Number($piecesStore?.length ?? 0));

	

	function navigateToPiece(id) {
		goto(`/indices/${id}`);
		scrollContainer.scrollTo(0, 0);	
	}



	let selected = $state(new Set());
	function toggle(i) {
		const s = new Set(selected);
		s.has(i) ? s.delete(i) : s.add(i);
		selected = s;
	}
	$effect(() => {
		pieceId;
		selected = new Set();
	});

	let selectedAnswer = $state(null);
	function toggleAnswer(i) {
		selectedAnswer = selectedAnswer === i ? null : i;
	}
	$effect(() => {
		pieceId;
		selectedAnswer = null;
	});
</script>

<!-- VERSION SVELTE 5 (Ã©vÃ©nements corrigÃ©s) -->

{#if currentPiece}
<div bind:this={scrollContainer} class="scroll-container">
	<div class="p-5 pt-0 pb-22" id="section-0">
		<!-- Header / onglets -->
		<header class="sticky left-5 top-0 z-10 flex items-center pt-4 pb-2 bg-white">
			<a href="/start" class="flex gap-2" aria-label="Retour au Chromogram">
				<img
					src="/images/retour_chromo.svg"
					alt="retour"
					class="h-auto !w-[162px]"
				/>
			</a>
		</header>

		<!-- Swiper -->
		<div class="mb-4 w-full">
			<swiper-container bind:this={swiperEl}>
				{#each currentPiece.images as img, i (i)}
					<swiper-slide>
						<img
							class="object-contain"
							src={img.src}
							alt={img.credits ?? `image ${i + 1}`}
						/>
						{#if img.credits}
							<p class="text-mini text-right italic pt-1 py-0 px-1">{img.credits}</p>
						{/if}
					</swiper-slide>
				{/each}
			</swiper-container>
		</div>

		<!-- Infos Å“uvre -->
		<div class="flex flex-col">
			<h2 class="text-dixsept whitespace-pre-line uppercase italic">
				{currentPiece.titre_artwork}
			</h2>
			<p>{currentPiece.artiste} - {currentPiece.date}</p>
			<p class="mt-3">{currentPiece.story}</p>
		</div>

		<!-- Bloc "D'aprÃ¨s toi..." -->
		<div class="relative mt-15 mb-16 bg-black border-white border px-5 py-6 pb-10 text-white" id="section-1">
			<img
				src="/images/aro_dapres_bas.svg"
				alt="indic"
				class="absolute right-5 bottom-2 h-auto !w-[97.9px]"
			/>
			<div class="text-titre-alt inf-bold bah mb-4">{currentPiece.dapres_toi}</div>

			{#if Array.isArray(currentPiece?.dapres) && currentPiece.dapres.length}
				{#each currentPiece.dapres as line, i (i)}
					<div
						class="flex cursor-pointer touch-none items-center gap-2 select-none"
						class:selected={selected.has(i)}
						onclick={() => {
							toggle(i);
							triggerConfetti(document.getElementById('section-1'), currentPiece.color);
						}}
					>
				<!-- Pseudo-case synchronisÃ©e -->
						<div class="pseudo-checkbox" class:checked={selected.has(i)}>
							<svg
								width="15"
								height="15"
								viewBox="0 0 15 15"
								fill="#fff"
								xmlns="http://www.w3.org/2000/svg"
							>
								<path
									d="M13.025 2.88117c-.3193-.31937-.6983-.57272-1.1155-.74557C11.4924 1.96275 11.0453 1.87378 10.5937 1.87378c-.4516 0-.89868.08897-1.31585.26182-.41716.17285-.79617.4262-1.1154.74557l-.6625.6625-.6625-.6625C6.19264 2.23636 5.3181 1.87411 4.4062 1.87411s-1.78644.36225-2.43125 1.00706C1.33014 3.52598.967896 4.40052.967896 5.31242c0 .9119.362244 1.78644 1.007054 2.43125l5.525 5.525 5.525-5.525c.3193-.31922.5727-.69824.7455-1.1154.1729-.41717.2618-.8643.2618-1.31585 0-.45155-.0889-.89869-.2618-1.31585-.1728-.41716-.4262-.79618-.7455-1.1154Z"
								/>
							</svg>
						</div>

						<span class:underline={selected.has(i)}>{line}</span>
						<!-- {#if selected.has(i)}
							<svg
								width="15"
								height="15"
								viewBox="0 0 15 15"
								fill="#fff"
								class="shrink-0"
							>
								<path
									d="M13.025 2.88117c-.3193-.31937-.6983-.57272-1.1155-.74557C11.4924 1.96275 11.0453 1.87378 10.5937 1.87378c-.4516 0-.89868.08897-1.31585.26182-.41716.17285-.79617.4262-1.1154.74557l-.6625.6625-.6625-.6625C6.19264 2.23636 5.3181 1.87411 4.4062 1.87411s-1.78644.36225-2.43125 1.00706C1.33014 3.52598.967896 4.40052.967896 5.31242c0 .9119.362244 1.78644 1.007054 2.43125l5.525 5.525 5.525-5.525c.3193-.31922.5727-.69824.7455-1.1154.1729-.41717.2618-.8643.2618-1.31585 0-.45155-.0889-.89869-.2618-1.31585-.1728-.41716-.4262-.79618-.7455-1.1154Z"
								/>
							</svg>
						{/if} -->
					</div>
				{/each}
			{/if}
		</div>

		<!-- Bloc Couleur (GSAP press & hold) -->
		<div
			id="section-2"
			class="relative overflow-hidden border px-5 py-4"
			onpointerdown={(e) => { e.preventDefault(); expand(e); }}
			onpointerup={shrink}
			onpointerleave={shrink}
			onpointercancel={shrink}
		>
			<div class="text-titre-alt inf-bold relative z-[1] mb-5 uppercase">
				{currentPiece?.color_name}
			</div>

			<div class="flex items-center gap-5">
				<div
					bind:this={circleEl}
					class="relative z-0 h-20 w-20 border border-white origin-center touch-none rounded-full select-none"
					style="background-color: {currentPiece?.color};"
				/>
				<div class="relative z-[1] leading-6">
					<span class="inf-bold">hexadÃ©cimale</span> : {currentPiece?.color}<br /><br />
					<span class="inf-bold">rvb</span> : {currentPiece?.rvb}<br /><br />
					<span class="inf-bold">cmjn</span> : {currentPiece?.cmjn}
				</div>
			</div>
		</div>

		<!-- Progress / navigation par couleurs -->
		<div class="m-auto mt-17 mb-10 h-px w-2/3 bg-black"></div>

		<div class="flex justify-center gap-[4vw]">
			{#each PIECES_ENTRIES as [id, data] (id)}
				<span
					class="rounded-full px-[3vw] py-[3vw] border-white border"
					style="background-color: {foundPieces.includes(id) ? data.color : '#E3E3E3'}"
					title={data.color_name}
					onclick={() => foundPieces.includes(id) && navigateToPiece(id)}
				/>
			{/each}
		</div>

		<div class="mt-5 mb-15 text-center text-titre-alt">
			<p>
				{#if totalPiece === 0}
					Tu n'as dÃ©couvert aucune couleur
				{:else if totalPiece === 1}
					Tu as dÃ©jÃ  dÃ©couvert 1 couleur sur 7 !
				{:else if totalPiece === 7}
					Bravo, Tu as dÃ©couvert toutes les couleurs !
				{:else}
					Tu as dÃ©jÃ  dÃ©couvert {totalPiece} couleurs sur 7 !
				{/if}
			</p>
		</div>

		{#if totalPiece !== 7}
			<div class="relative flex items-center justify-center">
				<div class="relative inline-block">
					<a href="/scanner" class="block">
						<svg width="52" height="43" viewBox="0 0 52 43" fill="none" xmlns="http://www.w3.org/2000/svg">
							<g clip-path="url(#clip0_2041_26)">
								<path d="M48 5H45V0H31V5H20V2H9V5H4C1.79 5 0 6.79 0 9V39C0 41.21 1.79 43 4 43H48C50.21 43 52 41.21 52 39V9C52 6.79 50.21 5 48 5ZM26.5 38C19.04 38 13 31.96 13 24.5C13 17.04 19.04 11 26.5 11C33.96 11 40 17.04 40 24.5C40 31.96 33.96 38 26.5 38Z" fill="black"/>
								<path d="M26.5 34C31.7467 34 36 29.7467 36 24.5C36 19.2533 31.7467 15 26.5 15C21.2533 15 17 19.2533 17 24.5C17 29.7467 21.2533 34 26.5 34Z" fill="black"/>
							</g>
						</svg>
					</a>
					<div class="absolute top-1/2 right-full -translate-y-1/2 pr-2">
						<img
							src="/images/indic_camera_oeuvre.svg"
							alt="gauche"
							class="pointer-events-none mr-2 h-auto !w-[116.556px] max-w-none"
						/>
					</div>
				</div>
			</div>
		{:else}
			<div class="mx-auto w-fit">
				<a href="/puzzles" class="text-bouton inf-bold z-10 border bg-white px-[15px] py-[7px] tracking-[4%] drop-shadow-[var(--my-drop-shadow)]">
					ACCÃˆDE AUX TANGRAMS
				</a>
			</div>
		{/if}
	</div>
</div>
{/if}


<style>

	.scroll-container {
		height: 100vh;
		overflow-y: auto;
		overflow-x: hidden;
		scroll-behavior: auto; /* on gÃ¨re le smoothScroll manuellement */
	}
	.bah::first-line {
		padding-right: 40px !important;
	}
	.swiper-button-next svg,
	.swiper-button-prev svg {
		width: 15px !important;
		height: auto !important;
	}
	.swiper-button-prev,
	.swiper-button-next {
		color: red; /* Couleur de la flÃ¨che (SVG currentColor) */
		font-size: 15px; /* Modifie la taille de l'icÃ´ne flÃ¨che */
		width: 24px;
		height: 24px;
	}

	.pseudo-checkbox {
		width: 15px;
		height: 15px;
		border: 1px solid white;
		display: flex;
		align-items: center;
		justify-content: center;
		transition: all 0.25s ease;
	}

	.pseudo-checkbox svg {
		opacity: 0;
		transform: scale(0.6);
		transition: all 0.25s ease;
	}

	.pseudo-checkbox.checked {
		border-color: #ffffff65;
		background-color: transparent;
	}

	.pseudo-checkbox.checked svg {
		opacity: 1;
		transform: scale(1);
	}

  input[type="checkbox"] {
    display: none;
  }

  input[type="checkbox"]:checked + .pseudo-checkbox {
    background-color: transparent; /* tu peux changer en #fff si tu veux fond plein */
  }

  input[type="checkbox"]:checked + .pseudo-checkbox svg {
    opacity: 1;
    transform: scale(1);
  }
</style>
